<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script>

        var ArrayProto = Array.prototype
        var push = ArrayProto.push, concat = ArrayProto.concat;

        var _ = function(obj)
        {
            if (obj instanceof _) return obj;
            if (!(this instanceof _)) return new _(obj);

            this._wrapped = obj;
        };

        _.isArray = function(obj)
        {
            return obj.length != null;
        };

        var flatten = function(input, shallow, output) {
            if (shallow && _.every(input, _.isArray)) {
                return concat.apply(output, input);
            }
            each(input, function(value) {
                if (_.isArray(value)) {
                    shallow ? push.apply(output, value) : flatten(value, shallow, output);
                } else {
                    output.push(value);
                }
            });
            return output;
        };

        // Flatten out an array, either recursively (by default), or just one level.
        _.flatten = function(array, shallow) {
            return flatten(array, shallow, []);
        };


        var each = function(obj, iterator)
        {
            obj.forEach(iterator);
        };

        _.mixin = function(obj) {
            each(["each", "flatten"], function(name) {
                var func = _[name] = obj[name];
                _.prototype[name] = function() {
                    var args = [this._wrapped];
                    return func.apply(_, args);
                };
            });
        };

        _.mixin(_);
    </script>
    <script>
        var a1 = assertEqual(_([1, [2]]).flatten(), [1,2]);
        a1;
    </script>
</head>
<body>

</body>
</html>