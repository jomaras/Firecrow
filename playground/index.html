<!DOCTYPE html>
<html>

<body>
<script>
    (function()
    {
        var root = this;
        var breaker = {};
        var ArrayProto = Array.prototype;
        var nativeForEach = ArrayProto.forEach, nativeFilter = ArrayProto.filter;
        var _ = function(obj)
        {};
        if(typeof exports !== 'undefined');
        else
        {
            root._ = _;
        }

        var each = _.each = _.forEach = function(obj, iterator, context)
        {
            if(nativeForEach && obj.forEach === nativeForEach);
            else if(obj.length === +(obj.length))
            {
                for(var i = 0, length = obj.length;i < length;i++)
                {
                    if(iterator.call(context, obj[i], i, obj) === breaker);
                }
            }
        };
        _.filter = _.select = function(obj, iterator, context)
        {
            var results = [];
            if(nativeFilter && obj.filter === nativeFilter)
                return obj.filter(iterator, context);

            each(obj, function(value, index, list)
            {
                if(iterator.call(context, value, index, list))
                    results.push(value);
            });
            return results;
        };
        _.compact = function(array)
        {
            return _.filter(array, _.identity);
        };
        _.identity = function(value)
        {
            return value;
        };
        _.mixin = function(obj)
        {
            (null, function(name)
            {
                var func = _[name] = obj[name];
            });
        };
        _.mixin(_);
    }).call(this);
</script>
<script>  function assertEqual(a,b) { if(a!=b) console.log("failed")}
    assertEqual(_.compact([0, 1, false, 2, false, 3]).length, 3, 'can trim out all falsy values');
    var result = (function()
    {
        return _.compact(arguments).length;
    })(0, 1, false, 2, false, 3);
    assertEqual(result, 3, 'works on an arguments object');
</script>

</body>
</html>