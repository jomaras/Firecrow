<!DOCTYPE html>
<html>
<head>

    <script>
        var _ = function(obj)
        {
            if(!(this instanceof _))
                return new _(obj);

            this._wrapped = obj;
        };
        _.isArray = function(obj)
        {
            return obj.length != null;
        };
        var flatten = function(input, shallow, output)
        {
            each(input, function(value)
            {
                if(_.isArray(value))
                {
                    shallow ? 0 : flatten(value, shallow, output);
                }
                else
                {
                    output.push(value);
                }
            });
            return output;
        };
        _.flatten = function(array, shallow)
        {
            return flatten(array, shallow, []);
        };
        var each = function(obj, iterator)
        {
            obj.forEach(iterator);
        };
        _.mixin = function(obj)
        {
            each(['each', 'flatten'], function(name)
            {
                var func = _[name] = obj[name];
                _.prototype[name] = function()
                {
                    var args = [this._wrapped];
                    return func.apply(_, args);
                };
            });
        };
        _.mixin(_);
    </script>
    <script>
        var a1 = assertEqual(_([1, [2]]).flatten(), [1,2]);
    </script>
</head>

</html>