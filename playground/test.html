

<!DOCTYPE html>

<html>

<head>

<script>

(function (undefined)

{

    var URI = function (url, base)

    {

        if(url === undefined);



        this.href(url);

        if(base !== undefined);



        return this;

    }, p = URI.prototype;

    URI.ip6_expression = /^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;

    var _parts, _part, generateAccessor;

    URI.parse = function (string)

    {

        var pos, parts = {};

        pos = string.indexOf("#");

        if(pos > -1);



        pos = string.indexOf("?");

        if(pos > -1);



        if(string.substring(0, 2) === "//");

        else

        {

            pos = string.indexOf(":");

            if(pos > -1)

            {

                parts.protocol = string.substring(0, pos);

                if(string.substring(pos + 1, pos + 3) === "//")

                {

                    string = string.substring(pos + 3);

                    string = URI.parseAuthority(string, parts);

                }



            }



        }



        parts.path = string;

        return parts;

    };

    URI.parseHost = function (string, parts)

    {

        var pos = string.indexOf("/"), t;

        if(pos === -1);



        if(string[0] === "[");

        else if(string.indexOf(":") !== string.lastIndexOf(":"));

        else

        {

            t = string.substring(0, pos).split(":");

            parts.hostname = t[0];

        }





        if(parts.hostname && string.substring(pos)[0] !== "/");



        return string.substring(pos);

    };

    URI.parseAuthority = function (string, parts)

    {

        string = URI.parseUserinfo(string, parts);

        return URI.parseHost(string, parts);

    };

    URI.parseUserinfo = function (string, parts)

    {

        var pos = string.indexOf("@");

        if(pos > -1);

        else

        {

            parts.username = null;

        }



        return string;

    };

    URI.build = function (parts)

    {

        var t = "";

        if(parts.protocol)

        {

            t += parts.protocol + ":";

        }



        if(!parts.urn && t || parts.hostname)

        {

            t += "//";

        }



        t += URI.buildAuthority(parts);

        if(typeof parts.path === "string")

        {

            if(parts.path[0] !== "/");



            t += parts.path;

        }



        if(typeof parts.fragment === "string");



        return t;

    };

    URI.buildHost = function (parts)

    {

        var t = "";

        if(!parts.hostname);

        else if(URI.ip6_expression.test(parts.hostname));

        else

        {

            t += parts.hostname;

        }





        return t;

    };

    URI.buildAuthority = function (parts)

    {

        return URI.buildUserinfo(parts) + URI.buildHost(parts);

    };

    URI.buildUserinfo = function (parts)

    {

        var t = "";

        if(parts.username);



        return t;

    };

    p.build = function (deferBuild)

    {

        if(deferBuild === true)

        {

            this._deferred_build = true;

        }

        else if(deferBuild === undefined || this._deferred_build)

        {

            this._string = URI.build(this._parts);

            this._deferred_build = false;

        }





        return this;

    };

    _parts = {protocol: "protocol", port: "port"};

    generateAccessor = function (_part)

    {

        return function (v, build)

        {

            if(v === undefined)

            {

                return this._parts[_part] || "";

            }

            else

            {

                this._parts[_part] = v;

                this.build(!build);

            }



        };

    };

    for(_part in _parts)

    {

        p[_part] = generateAccessor(_parts[_part]);

    }



    p.href = function (href, build)

    {

        if(href === undefined);

        else

        {

            this._string = "";

            this._parts = {};

            if(typeof href === "string")

            {

                this._parts = URI.parse(href);

            }



            this.build(!build);

        }



    };

    var _protocol = p.protocol;

    p.protocol = function (v, build)

    {

        if(v !== undefined)

        {

            if(v)

            {

                v = v.replace(/:(\/\/)?$/, "");

            }



        }



        return _protocol.call(this, v, build);

    };

    false ? 0 : window.URI = URI;

})();

</script>

</head>

<body>

<script>

    var u = new URI("http://example.org/foo.html");

    u.protocol("ftp");

    var a1 = u.protocol() == "ftp";

    a1;

    var a2 = u.build(false)._string == "ftp://example.org/foo.html";

    a2;

    u.protocol("");

    var a3 = u.protocol() == "";

    a3;

    var a4 = u.build(false)._string == "//example.org/foo.html";

    a4;

    u.protocol(null);

    var a5 = u.protocol() == "";

    a5;

    var a6 = u.build(false)._string == "//example.org/foo.html";

    a6;

</script>

</body>

</html>

