!function(e){var t="object"==typeof exports,n="undefined"==typeof JS?require("./core"):JS,s=n.Console||require("./console").Console,r=n.DOM||require("./dom").DOM,i=n.Enumerable||require("./enumerable").Enumerable,a=n.SortedSet||require("./set").SortedSet,o=n.Range||require("./range").Range,c=n.Hash||require("./hash").Hash,u=n.MethodChain||require("./method_chain").MethodChain,l=n.Comparable||require("./comparable").Comparable,h=n.StackTrace||require("./stack_trace").StackTrace;t&&(exports.JS=exports),e(n,s,r,i,a,o,c,u,l,h,t?exports:n)}(function(e,t,n,s,r,i,a,o,c,u,l){"use strict";var h=new e.Module("Test",{extend:{asyncTimeout:5,filter:function(e,t){return h.Runner.filter(e,t)},Reporters:new e.Module({extend:{METHODS:["startSuite","startContext","startTest","update","addFault","endTest","endContext","endSuite"],_registry:{},register:function(e,t){this._registry[e]=t},get:function(e){return e?this._registry[e]||null:null}}}),UI:new e.Module({}),Unit:new e.Module({})}});h.Unit.extend({Observable:new e.Module({addListener:function(e,t,n){if(void 0===t)throw Error("No callback was passed as a listener");return this.channels()[e]=this.channels()[e]||[],this.channels()[e].push([t,n]),t},removeListener:function(e,t){var n=this.channels()[e];if(n){for(var s=n.length;s--;)if(n[s][0]===t)return n.splice(s,1),t;return null}},notifyListeners:function(t,n){var n=e.array(arguments),t=n.shift(),s=this.channels()[t];if(!s)return 0;for(var r=0,i=s.length;i>r;r++)s[r][0].apply(s[r][1]||null,n);return s.length},channels:function(){return this.__channels__=this.__channels__||[]}})}),h.Unit.extend({isFailure:function(t){for(var n=h.ASSERTION_ERRORS,s=n.length;s--;)if(e.isType(t,n[s]))return!0;return!1},AssertionFailedError:new e.Class(Error,{initialize:function(e){this.message=""+e}}),Assertions:new e.Module({assertBlock:function(e,t,n){"function"==typeof e&&(n=t,t=e,e=null),this.__wrapAssertion__(function(){if(!t.call(n))throw e=this.buildMessage(e||"assertBlock failed"),new h.Unit.AssertionFailedError(e)})},flunk:function(e){this.assertBlock(this.buildMessage(e||"Flunked"),function(){return!1})},assert:function(e,t){this.__wrapAssertion__(function(){this.assertBlock(this.buildMessage(t,"<?> is not true",e),function(){return e})})},assertNot:function(e,t){this.__wrapAssertion__(function(){this.assertBlock(this.buildMessage(t,"<?> is not false",e),function(){return!e})})},assertEqual:function(e,t,n){var r=this.buildMessage(n,"<?> expected but was\n<?>",e,t);this.assertBlock(r,function(){return s.areEqual(e,t)})},assertNotEqual:function(e,t,n){var r=this.buildMessage(n,"<?> expected not to be equal to\n<?>",e,t);this.assertBlock(r,function(){return!s.areEqual(e,t)})},assertNull:function(e,t){this.assertEqual(null,e,t)},assertNotNull:function(e,t){var n=this.buildMessage(t,"<?> expected not to be null",e);this.assertBlock(n,function(){return null!==e})},assertKindOf:function(t,n,s){this.__wrapAssertion__(function(){var r=n&&"string"!=typeof t?n.klass||n.constructor:typeof n,i=this.buildMessage(s,"<?> expected to be an instance of\n<?> but was\n<?>",n,t,r);this.assertBlock(i,function(){return e.isType(n,t)})})},assertRespondTo:function(e,t,n){this.__wrapAssertion__(function(){var s=this.buildMessage("","<?>\ngiven as the method name argument to #assertRespondTo must be a String",t);this.assertBlock(s,function(){return"string"==typeof t});var r=e?e.constructor:typeof e;s=this.buildMessage(n,"<?>\nof type <?>\nexpected to respond to <?>",e,r,t),this.assertBlock(s,function(){return e&&void 0!==e[t]})})},assertMatch:function(t,n,s){this.__wrapAssertion__(function(){var r=this.buildMessage(s,"<?> expected to match\n<?>",n,t);this.assertBlock(r,function(){return e.match(t,n)})})},assertNoMatch:function(e,t,n){this.__wrapAssertion__(function(){var s=this.buildMessage(n,"<?> expected not to match\n<?>",t,e);this.assertBlock(s,function(){return"function"==typeof e.test?!e.test(t):!e.match(t)})})},assertSame:function(e,t,n){var s=this.buildMessage(n,"<?> expected to be the same as\n<?>",e,t);this.assertBlock(s,function(){return t===e})},assertNotSame:function(e,t,n){var s=this.buildMessage(n,"<?> expected not to be the same as\n<?>",e,t);this.assertBlock(s,function(){return t!==e})},assertInDelta:function(e,t,n,s){this.__wrapAssertion__(function(){this.assertKindOf("number",e),this.assertKindOf("number",t),this.assertKindOf("number",n),this.assert(n>=0,"The delta should not be negative");var r=this.buildMessage(s,"<?> and\n<?> expected to be within\n<?> of each other",e,t,n);this.assertBlock(r,function(){return Math.abs(e-t)<=n})})},assertSend:function(e,t){this.__wrapAssertion__(function(){this.assertKindOf(Array,e,"assertSend requires an array of send information"),this.assert(e.length>=2,"assertSend requires at least a receiver and a message name");var n=this.buildMessage(t,"<?> expected to respond to\n<?(?)> with a true value",e[0],h.Unit.AssertionMessage.literal(e[1]),e.slice(2));this.assertBlock(n,function(){return e[0][e[1]].apply(e[0],e.slice(2))})})},__processExceptionArgs__:function(t){var t=e.array(t),n="function"==typeof t[t.length-1]?null:t.pop(),r=t.pop(),i=e.isType(t[t.length-1],"string")?t.pop():"",a=new s.Collection(t);return[t,a,i,r,n]},assertThrow:function(){var t=this.__processExceptionArgs__(arguments),n=t[0],s=t[1],r=t[2],i=t[3],a=t[4];this.__wrapAssertion__(function(){var t,o=this.buildMessage(r,"<?> exception expected but none was thrown",n);this.assertBlock(o,function(){try{i.call(a)}catch(e){return t=e,!0}return!1}),o=this.buildMessage(r,"<?> exception expected but was\n?",n,t),this.assertBlock(o,function(){return s.any(function(n){return e.isType(t,n)||t.name&&t.name===n.name})})})},assertThrows:function(){return this.assertThrow.apply(this,arguments)},assertNothingThrown:function(){var t=this.__processExceptionArgs__(arguments),n=t[0],s=t[1],r=t[2],i=t[3],a=t[4];this.__wrapAssertion__(function(){try{i.call(a)}catch(t){if((0!==n.length||h.Unit.isFailure(t))&&!s.any(function(n){return e.isType(t,n)}))throw t;this.assertBlock(this.buildMessage(r,"Exception thrown:\n?",t),function(){return!1})}})},buildMessage:function(){var t=e.array(arguments),n=t.shift(),s=t.shift();return new h.Unit.AssertionMessage(n,s,t)},__wrapAssertion__:function(e){if(void 0===this.__assertionWrapped__&&(this.__assertionWrapped__=!1),this.__assertionWrapped__)return e.call(this);this.__assertionWrapped__=!0;try{return this.addAssertion(),e.call(this)}finally{this.__assertionWrapped__=!1}},addAssertion:function(){}})}),h.extend({ASSERTION_ERRORS:[h.Unit.AssertionFailedError]}),t.NODE&&h.ASSERTION_ERRORS.push(require("assert").AssertionError),h.Unit.extend({AssertionMessage:new e.Class({extend:{Literal:new e.Class({initialize:function(e){this._value=e,this.toString=this.inspect},inspect:function(){return""+this._value}}),literal:function(e){return new this.Literal(e)},Template:new e.Class({extend:{create:function(e){var t=e?e.match(/\(\?\)|(?=[^\\])\?|(?:(?!\(\?\))(?:\\\?|[^\?]))+/g):[];return new this(t)}},initialize:function(e){this._parts=new s.Collection(e),this.count=this._parts.findAll(function(e){return"?"===e||"(?)"===e}).length},result:function(t){if(t.length!==this.count)throw"The number of parameters does not match the number of substitutions";var n=e.array(t);return this._parts.collect(function(e){return"(?)"===e?n.shift().replace(/^\[/,"(").replace(/\]$/,")"):"?"===e?n.shift():e.replace(/\\\?/g,"?")}).join("")}})},initialize:function(e,t,n){this._head=e,this._templateString=t,this._parameters=new s.Collection(n)},template:function(){return this._template=this._template||this.klass.Template.create(this._templateString)},toString:function(){var e,n=[];return this._head&&n.push(this._head),e=this.template().result(this._parameters.collect(function(e){return t.convert(e)},this)),""!==e&&n.push(e),n.join("\n")}})}),h.Unit.extend({Failure:new e.Class({initialize:function(e,t){this._testCase=e,this._message=t},metadata:function(){return{test:this.testMetadata(),error:this.errorMetadata()}},testMetadata:function(){return this._testCase.metadata()},errorMetadata:function(){return{type:"failure",message:this._message}}})}),h.Unit.extend({Error:new e.Class({initialize:function(e,t){"string"==typeof t&&(t=Error(t)),this._testCase=e,this._exception=t},metadata:function(){return{test:this.testMetadata(),error:this.errorMetadata()}},testMetadata:function(){return this._testCase.metadata()},errorMetadata:function(){return{type:"error",message:this._exception.name+": "+this._exception.message,backtrace:t.filterBacktrace(this._exception.stack)}}})}),h.Unit.extend({TestResult:new e.Class({include:h.Unit.Observable,extend:{CHANGED:"Test.Unit.TestResult.CHANGED",FAULT:"Test.Unit.TestResult.FAULT"},initialize:function(){this._runCount=this._assertionCount=0,this._failures=[],this._errors=[]},addRun:function(){this._runCount+=1,this.notifyListeners(this.klass.CHANGED,this)},addFailure:function(e){this._failures.push(e),this.notifyListeners(this.klass.FAULT,e),this.notifyListeners(this.klass.CHANGED,this)},addError:function(e){this._errors.push(e),this.notifyListeners(this.klass.FAULT,e),this.notifyListeners(this.klass.CHANGED,this)},addAssertion:function(){this._assertionCount+=1,this.notifyListeners(this.klass.CHANGED,this)},passed:function(){return 0===this._failures.length&&0===this._errors.length},runCount:function(){return this._runCount},assertionCount:function(){return this._assertionCount},failureCount:function(){return this._failures.length},errorCount:function(){return this._errors.length},metadata:function(){return{passed:this.passed(),tests:this.runCount(),assertions:this.assertionCount(),failures:this.failureCount(),errors:this.errorCount()}}})}),h.Unit.extend({TestSuite:new e.Class({include:s,extend:{STARTED:"Test.Unit.TestSuite.STARTED",FINISHED:"Test.Unit.TestSuite.FINISHED",forEach:function(n,s,r,i){var a=!1,o=!1,c=n.length,u=-1,l=(new e.Date).getTime(),d=h.FakeClock.REAL.setTimeout,f=function(){o=!0;var n=(new e.Date).getTime();if(t.BROWSER&&n-l>1e3)l=n,a=!1,d(_,0);else if(!a)for(a=!0;a;)_()},_=function(){return u+=1,u===c?(a=!1,r&&r.call(i)):(o=!1,s.call(i,n[u],f),o||(a=!1),void 0)};f()}},initialize:function(e,t){this._metadata=e,this._tests=t},forEach:function(e,t,n){this.klass.forEach(this._tests,e,t,n)},run:function(e,t,n,s){this._metadata.fullName&&n.call(s,this.klass.STARTED,this),this.forEach(function(t,r){t.run(e,r,n,s)},function(){this._metadata.fullName&&n.call(s,this.klass.FINISHED,this),t.call(s)},this)},size:function(){if(void 0!==this._size)return this._size;for(var e=0,t=this._tests.length;t--;)e+=this._tests[t].size();return this._size=e},empty:function(){return 0===this._tests.length},metadata:function(t){var n=e.extend({size:this.size()},this._metadata);return t&&(delete n.fullName,delete n.shortName,delete n.context),n}})}),h.Unit.extend({TestCase:new e.Class({include:h.Unit.Assertions,extend:{STARTED:"Test.Unit.TestCase.STARTED",FINISHED:"Test.Unit.TestCase.FINISHED",reports:[],handlers:[],clear:function(){this.testCases=[]},inherited:function(e){this.testCases||(this.testCases=[]),this.testCases.push(e)},pushErrorCathcer:function(e,n){return e?(this.popErrorCathcer(!1),t.NODE?process.addListener("uncaughtException",e):t.BROWSER&&(window.onerror=e),n!==!1&&this.handlers.push(e),e):void 0},popErrorCathcer:function(e){var n=this.handlers,s=n[n.length-1];s&&(t.NODE?process.removeListener("uncaughtException",s):t.BROWSER&&(window.onerror=null),e!==!1&&(n.pop(),this.pushErrorCathcer(n[n.length-1],!1)))},processError:function(e,t){t&&(h.Unit.isFailure(t)?e.addFailure(t.message):e.addError(t))},runWithExceptionHandlers:function(e,t,n,s){try{t.call(e)}catch(r){n&&n.call(e,r)}finally{s&&s.call(e)}},metadata:function(){for(var e=this.displayName,t=[],n=this,s=h.Unit.TestCase;n!==s;)t.unshift(n.displayName),n=n.superclass;return t.pop(),{fullName:this===s?"":t.concat(e).join(" "),shortName:e,context:this===s?null:t}},suite:function(e){var t,n,r,i=this.metadata(),a=(h.Unit.TestCase,i.fullName),o=new s.Collection(this.instanceMethods(!1)),c=[],u=[],l=o.select(function(t){return/^test./.test(t)?(t=t.replace(/^test:\W*/gi,""),this.filter(a+" "+t,e)):!1},this).sort();for(n=0,r=l.length;r>n;n++)try{c.push(new this(l[n]))}catch(d){}if(this.testCases)for(n=0,r=this.testCases.length;r>n;n++)t=this.testCases[n].suite(e),0!==t.size()&&(u.push(this.testCases[n].displayName),c.push(t));return i.children=u,new h.Unit.TestSuite(i,c)},filter:function(e,t){if(!t||0===t.length)return!0;for(var n=t.length;n--;)if(e.indexOf(t[n])>=0)return!0;return!1}},initialize:function(e){if("function"!=typeof this[e])throw"invalid_test";this._methodName=e,this._testPassed=!0},run:function(e,t,n,s){n.call(s,this.klass.STARTED,this),this._result=e;var r=function(r){this.klass.processError(this,r),this.exec("teardown",function(r){this.klass.processError(this,r),this.exec(function(){h.Unit.mocking.verify()},function(r){this.klass.processError(this,r),e.addRun(),n.call(s,this.klass.FINISHED,this),t()})})};this.exec("setup",function(){this.exec(this._methodName,r)},r)},exec:function(t,n,s){if(!t)return n.call(this);s||(s=n);var r="function"==typeof t?t.length:this.__eigen__().instanceMethod(t).arity,i="function"==typeof t?t:this[t],a=null,o=!1,c=!1,u=this;if(0===r)return this.klass.runWithExceptionHandlers(this,function(){i.call(this),n.call(this)},s);var l=function(t){o=!0,u.klass.popErrorCathcer(),a&&e.ENV.clearTimeout(a),s.call(u,t)};this.klass.pushErrorCathcer(l),this.klass.runWithExceptionHandlers(this,function(){i.call(this,function(t){c=!0,u.klass.popErrorCathcer(),a&&e.ENV.clearTimeout(a),o||("string"==typeof t&&(t=Error(t)),"object"==typeof t&&null!==t?l(t):"function"==typeof t?u.exec(t,n,s):u.exec(null,n,s))})},s),!c&&e.ENV.setTimeout&&(a=e.ENV.setTimeout(function(){o=!0,u.klass.popErrorCathcer();var e="Timed out after waiting "+h.asyncTimeout+" seconds for test to resume";s.call(u,Error(e))},1e3*h.asyncTimeout))},setup:function(){},teardown:function(){},passed:function(){return this._testPassed},size:function(){return 1},addAssertion:function(){this._result.addAssertion()},addFailure:function(e){this._testPassed=!1,this._result.addFailure(new h.Unit.Failure(this,e))},addError:function(e){this._testPassed=!1,this._result.addError(new h.Unit.Error(this,e))},metadata:function(){var e=this.klass.metadata(),t=this._methodName.replace(/^test:\W*/gi,"");return{fullName:e.fullName+" "+t,shortName:t,context:e.context.concat(e.shortName)}},toString:function(){return"TestCase{"+this.metadata().fullName+"}"}})}),h.UI.extend({Terminal:new e.Class({getOptions:function(){var e={},n=t.envvar("FORMAT"),s=t.envvar("TEST");return t.envvar("TAP")&&(e.format="tap"),n&&(e.format=n),s&&(e.test=[s]),delete e.argv,e.test=e.test||[],e},getReporters:function(e){var t=h.Reporters,n=t.get(e.format)||t.Dot;return[new t.Coverage(e),new n(e),new t.ExitStatus(e)]}})}),h.UI.extend({Browser:new e.Class({getOptions:function(){for(var e,t,n,s=(location.search||"").replace(/^\?/,""),r=s.split("&"),i={},a=0,o=r.length;o>a;a++)e=r[a].split("="),t=decodeURIComponent(e[0]),n=decodeURIComponent(e[1]),/\[\]$/.test(e[0])?(t=t.replace(/\[\]$/,""),i[t]instanceof Array||(i[t]=[]),i[t].push(n)):i[t]=n;return i.test=i.test?[].concat(i.test):[],i},getReporters:function(e){var t,n=[],s=h.Reporters,r=s._registry,i=new s.Browser(e);n.push(new s.Coverage),n.push(i);for(var a in r)t=r[a]&&r[a].create&&r[a].create(e,i),t&&n.push(t);return n}})}),h.Reporters.extend({Error:new e.Class({include:t,NAMES:{failure:"Failure",error:"Error"},startSuite:function(e){this._faults=[],this._start=e.timestamp,this.consoleFormat("bold"),this.puts("Loaded suite: "+e.children.join(", ")),this.reset(),this.puts("")},startContext:function(){},startTest:function(){},addFault:function(e){this._faults.push(e),this._printFault(this._faults.length,e)},update:function(){},endTest:function(){},endContext:function(){},endSuite:function(e){this._printSummary(e)},_printFault:function(e,t){this.consoleFormat("bold","red"),this.puts(e+") "+this.NAMES[t.error.type]+": "+t.test.fullName),this.reset(),this.puts(t.error.message),t.error.backtrace&&(this.grey(),this.puts(t.error.backtrace)),this.reset(),this.puts("")},_printSummary:function(e){var t=(e.timestamp-this._start)/1e3;this.reset(),this.puts("Finished in "+t+" seconds");var n=e.passed?"green":"red";this.consoleFormat(n),this.puts(this._plural(e.tests,"test")+", "+this._plural(e.assertions,"assertion")+", "+this._plural(e.failures,"failure")+", "+this._plural(e.errors,"error")),this.reset(),this.puts("")},_plural:function(e,t){return e+" "+t+(1===e?"":"s")}})}),h.Reporters.register("error",h.Reporters.Error),h.Reporters.extend({Dot:new e.Class(h.Reporters.Error,{SYMBOLS:{failure:"F",error:"E"},startTest:function(){this._outputFault=!1},addFault:function(e){this._faults.push(e),this._outputFault||(this._outputFault=!0,this.consoleFormat("bold","red"),this.print(this.SYMBOLS[e.error.type]),this.reset())},endTest:function(){this._outputFault||(this.consoleFormat("green"),this.print("."),this.reset())},endSuite:function(e){this.puts("\n");for(var t=0,n=this._faults.length;n>t;t++)this._printFault(t+1,this._faults[t]);this._printSummary(e)}})}),h.Reporters.register("dot",h.Reporters.Dot),h.Reporters.extend({JSON:new e.Class({include:t,_log:function(t,n){e.ENV.JSON&&this.puts(JSON.stringify({jstest:[t,n]}))},extend:{create:function(){return e.ENV.navigator?h.Reporters.Headless.UA.test(navigator.userAgent)?new this:void 0:void 0},Reader:new e.Class({initialize:function(e){this._reporter=new h.Reporters.Composite([e])},read:function(t){if(!e.ENV.JSON)return!1;try{var n=JSON.parse(t),s=n.jstest,r=s[0],i=s[1];return this._reporter[r](i),!0}catch(a){return!1}}})}})}),function(){for(var e=h.Reporters.METHODS,t=e.length;t--;)(function(t){var n=e[t];h.Reporters.JSON.define(n,function(e){this._log(n,e)})})(t)}(),h.Reporters.register("json",h.Reporters.JSON),h.Reporters.extend({TAP:new e.Class({extend:{HOSTNAME:"testling",create:function(t){if(e.ENV.location){var n=location.hostname.split(".");return e.indexOf(n,this.HOSTNAME)>=0?new this(t):void 0}}},include:t,startSuite:function(e){this._testId=0,this.puts("1.."+e.size)},startContext:function(){},startTest:function(){this._testPassed=!0,this._faults=[]},addFault:function(e){this._testPassed=!1,this._faults.push(e)},endTest:function(e){var t=this._testPassed?"ok":"not ok";t+=" "+ ++this._testId+" - "+this._format(e.fullName),this.puts(t);for(var n,s,r,i,a,o=0,c=this._faults.length;c>o;o++){n=this._faults[o];var s=n.error.message;for(n.error.backtrace&&(s+="\n"+n.error.backtrace),r=s.split(/[\r\n]/),i=0,a=r.length;a>i;i++)this.puts("    "+r[i])}},endContext:function(){},update:function(){},endSuite:function(){},_format:function(e){return e.replace(/[\s\t\r\n]+/g," ")}})}),h.Reporters.register("tap",h.Reporters.TAP),h.Reporters.extend({ExitStatus:new e.Class({startSuite:function(){},startContext:function(){},startTest:function(){},addFault:function(){},endTest:function(){},endContext:function(){},update:function(){},endSuite:function(e){t.exit(e.passed?0:1)}})}),h.Reporters.extend({Headless:new e.Class({extend:{UA:/\b(PhantomJS|SlimerJS)\b/},initialize:function(e){this._options=e||{};var n=t.envvar("FORMAT");t.envvar("TAP")&&(n=n||"tap"),this._options.format=this._options.format||n;var s=h.Reporters,r=s.get(this._options.format)||s.Dot,i=new s.Composite;i.addReporter(new r(e)),i.addReporter(new s.ExitStatus),this._reader=new s.JSON.Reader(i)},open:function(e){var t="function"==typeof WebPage?new WebPage:require("webpage").create(),n=this;return t.onConsoleMessage=function(e){n._reader.read(e)||console.log(e)},t.open(e),t}})}),h.Reporters.extend({Browser:new e.Class({initialize:function(e){this._options=e||{}},_contextFor:function(e){for(var t=this._context,n=e.context,s=0,r=n.length;r>s;s++)t=t.child(n[s]);return t},startSuite:function(e){var t=this;this._container&&document.body.removeChild(this._container),this._start=e.timestamp,this._container=n.div({className:"test-result-container"},function(e){e.table({className:"report"},function(e){e.thead(function(e){e.tr(function(e){e.th({scope:"col"},"Tests"),e.th({scope:"col"},"Assertions"),e.th({scope:"col"},"Failures"),e.th({scope:"col"},"Errors")})}),e.tbody(function(e){e.tr(function(e){t._tests=e.td(),t._assertions=e.td(),t._failures=e.td(),t._errors=e.td()})})}),t._light=e.div({className:"light light-pending"}),e.p({className:"user-agent"},window.navigator.userAgent),t._context=new t.klass.Context("spec",e.ul({className:"specs"}),void 0,t._options),t._summary=e.p({className:"summary"})}),document.body.insertBefore(this._container,document.body.firstChild),this.update({tests:0,assertions:0,failures:0,errors:0})},startContext:function(){},startTest:function(e){this._contextFor(e).addTest(e.shortName)},addFault:function(e){this._contextFor(e.test).child(e.test.shortName).addFault(e.error)},endTest:function(){},endContext:function(){},update:function(e){this._tests.innerHTML=e.tests+"",this._assertions.innerHTML=e.assertions+"",this._failures.innerHTML=e.failures+"",this._errors.innerHTML=e.errors+""},endSuite:function(e){this.update(e),n.removeClass(this._light,"light-pending"),n.addClass(this._light,e.passed?"light-passed":"light-failed");var t=(e.timestamp-this._start)/1e3;this._summary.innerHTML="Finished in "+t+" seconds"},serialize:function(){for(var e=document.getElementsByTagName("li"),t=e.length;t--;)n.removeClass(e[t],"closed");for(var e=document.getElementsByTagName("script"),t=e.length;t--;)e[t].parentNode.removeChild(e[t]);var s=document.getElementsByTagName("html")[0];return"<!doctype html><html>"+s.innerHTML+"</html>"}})}),h.Reporters.Browser.extend({Context:new e.Class({initialize:function(e,t,s,r){if(this._parent=t,this._type=e,this._name=s,this._options=r,this._children=[],void 0===s)return this._ul=t,void 0;var i=this._parent._ul||this._parent,a={_tests:"Tests",_failures:"Failed"},o=this;this._li=new n.Builder(i).li({className:this._type+" passed"},function(e){e.ul({className:"stats"},function(e){for(var t in a)e.li(function(e){e.span({className:"label"},a[t]+": "),o[t]=e.span({className:"number"},"0")})}),s&&(o._toggle=e.p({className:o._type+"-name"},s),o._runner=n.span({className:"runner"},"Run"),o._toggle.insertBefore(o._runner,o._toggle.firstChild)),o._ul=e.ul({className:"children"})});var c=this._options.test||[];0===c.length&&n.addClass(this._li,"closed"),n.Event.on(this._toggle,"click",function(){n.toggleClass(this._li,"closed")},this),this._runner&&n.Event.on(this._runner,"click",this.runTest,this)},ping:function(e){this[e]&&(this[e].innerHTML=parseInt(this[e].innerHTML)+1,this._parent.ping&&this._parent.ping(e))},fail:function(){this._li&&(n.removeClass(this._li,"passed"),n.addClass(this._toggle,"failed"),this._parent.fail&&this._parent.fail())},child:function(e){return this._children[e]=this._children[e]||new this.klass("spec",this,e,this._options)},addTest:function(e){var t=this._children[e]=new this.klass("test",this,e,this._options);t.ping("_tests")},addFault:function(e){var t=e.message;e.backtrace&&(t+="\n"+e.backtrace);var s=n.li({className:"fault"},function(e){e.p(function(e){for(var n=t.split(/[\r\n]+/),s=0,r=n.length;r>s;s++)s>0&&e.br(),e.concat(n[s])})});this._ul.appendChild(s),this.ping("_failures"),this.fail()},getName:function(){var e=[],t=this._parent&&this._parent.getName&&this._parent.getName();return t&&e.push(t),e.push(this._name),e.join(" ")},runTest:function(){window.location.search="test="+encodeURIComponent(this.getName())}})}),h.Reporters.extend({Coverage:new e.Class({include:t,startSuite:function(){},startContext:function(){},startTest:function(){},addFault:function(){},endTest:function(){},endContext:function(){},update:function(){},endSuite:function(){for(var e=h.Unit.TestCase.reports,t=0,n=e.length;n>t;t++)this.reset(),this.puts(""),e[t].report()}})}),h.Reporters.extend({Composite:new e.Class({initialize:function(e){this._reporters=e||[],this._queue=[],this._pointer=0},addReporter:function(e){e&&this._reporters.push(e)},removeReporter:function(t){var n=e.indexOf(this._reporters,t);n>=0&&this._reporters.splice(n,1)},flush:function(){for(var e,t,n,s,r,i=this._queue;void 0!==i[this._pointer];){for(e=i[this._pointer][0],t=i[this._pointer][1],n=0,s=this._reporters.length;s>n;n++)r=this._reporters[n][e],r&&r.call(this._reporters[n],t);this._pointer+=1}}})}),function(){for(var e=h.Reporters.METHODS,t=e.length;t--;)(function(t){var n=e[t];h.Reporters.Composite.define(n,function(e){this._queue[e.eventId]=[n,e],this.flush()})})(t)}(),h.Reporters.extend({TestSwarm:new e.Class({extend:{create:function(t,n){return e.ENV.TestSwarm?new this(t,n):void 0}},initialize:function(e,t){this._browserReporter=t,TestSwarm.serialize=function(){return t.serialize()}},startSuite:function(){},startContext:function(){},startTest:function(){},addFault:function(){},endTest:function(){TestSwarm.heartbeat()},endContext:function(){},update:function(){},endSuite:function(e){TestSwarm.submit({fail:e.failures,error:e.errors,total:e.tests})}})}),h.Reporters.register("testswarm",h.Reporters.TestSwarm),h.extend({Context:new e.Module({extend:{included:function(e){e.extend(h.Context.Context,{_resolve:!1}),e.include(h.Context.LifeCycle,{_resolve:!1}),e.extend(h.Context.Test,{_resolve:!1}),e.include(t)},Context:new e.Module({context:function(t,n){var s=new e.Class(""+t,this,{},{_resolve:!1});return s.__eigen__().resolve(),n.call(s),s},cover:function(e){var t=new h.Coverage(e);this.before_all_callbacks.push(t.method("attach")),this.after_all_callbacks.push(t.method("detach")),h.Unit.TestCase.reports.push(t)}})}}),describe:function(t,n){var s=new e.Class(""+t,h.Unit.TestCase,{},{_resolve:!1});return s.include(h.Context,{_resolve:!1}),s.__eigen__().resolve(),n.call(s),s}}),h.Context.Context.alias({describe:"context"}),h.extend({context:h.describe}),h.Context.LifeCycle=new e.Module({extend:{included:function(e){e.extend(this.ClassMethods),e.before_all_callbacks=[],e.before_each_callbacks=[],e.after_all_callbacks=[],e.after_each_callbacks=[],e.before_should_callbacks={},e.extend({inherited:function(e){this.callSuper(),e.before_all_callbacks=[],e.before_each_callbacks=[],e.after_all_callbacks=[],e.after_each_callbacks=[],e.before_should_callbacks={}}})},ClassMethods:new e.Module({blockTransform:function(e){return e},before:function(e,t){void 0===t&&(t=e,e="each"),this["before_"+(e+"_")+"callbacks"].push(this.blockTransform(t))},after:function(e,t){void 0===t&&(t=e,e="each"),this["after_"+(e+"_")+"callbacks"].push(this.blockTransform(t))},gatherCallbacks:function(e,t){var n="function"==typeof this.superclass.gatherCallbacks?this.superclass.gatherCallbacks(e,t):[],s=this[e+"_"+(t+"_")+"callbacks"];return"before"===e?n.concat(s):s.concat(n)}})},setup:function(e){this.klass.before_should_callbacks[this._methodName]&&this.klass.before_should_callbacks[this._methodName].call(this),this.runCallbacks("before","each",e)},teardown:function(e){this.runCallbacks("after","each",e)},runCallbacks:function(e,t,n){var s=this.klass.gatherCallbacks(e,t);h.Unit.TestSuite.forEach(s,function(e,t){this.exec(e,t,n)},n,this)},runAllCallbacks:function(e,t,n){var s=this.instanceVariables();this.runCallbacks(e,"all",function(){var e=this.instanceVariables().inject({},function(e,t){return s.member(t)?e:(e[t]=this[t],e)},this);t&&t.call(n,e)})},setValuesFromCallbacks:function(e){for(var t in e)this[t]=e[t]},instanceVariables:function(){var e=[];for(var t in this)this.hasOwnProperty(t)&&e.push(t);return new s.Collection(e)}}),function(){var e=h.Context.LifeCycle.ClassMethods.method("instanceMethod");h.Context.LifeCycle.ClassMethods.include({setup:e("before"),teardown:e("after")})}(),h.Context.extend({SharedBehavior:new e.Class(e.Module,{extend:{createFromBehavior:function(e){var t=new this;return t._behavior=e,t},moduleName:function(e){return e.toLowerCase().replace(/[\s:',\.~;!#=\(\)&]+/g,"_").replace(/\/(.?)/g,function(e,t){return"."+t.toUpperCase()}).replace(/(?:^|_)(.)/g,function(e,t){return t.toUpperCase()})}},included:function(e){this._behavior.call(e)}})}),h.Unit.TestCase.extend({shared:function(t,n){t=h.Context.SharedBehavior.moduleName(t),e.ENV[t]=h.Context.SharedBehavior.createFromBehavior(n)},use:function(t){if(e.isType(t,h.Context.SharedBehavior)||e.isType(t,e.Module))this.include(t);else if(e.isType(t,"string")){var n=h.Context.SharedBehavior.moduleName(t),s=e.ENV[n];if(!s)throw Error('Could not find example group named "'+t+'"');this.include(s)}}}),function(){var e=function(e,t){for(var n={},s=0,r=t.length;r>s;s++)n[t[s]]=h.Unit.TestCase[e];h.Unit.TestCase.extend(n)};e("shared",["sharedBehavior","shareAs","shareBehaviorAs","sharedExamplesFor"]),e("use",["uses","itShouldBehaveLike","behavesLike","usesExamplesFrom"])}(),h.Context.Test=new e.Module({test:function(t,n,s){var r="test: "+t;if(e.indexOf(this.instanceMethods(!1),r)>=0)throw Error(r+" is already defined in "+this.displayName);n=n||{},"function"==typeof n?s=n:void 0!==n.before&&(this.before_should_callbacks[r]=n.before),this.define(r,this.blockTransform(s),{_resolve:!1})},beforeTest:function(e,t){this.it(e,{before:t},function(){})}}),h.Context.Test.alias({it:"test",should:"test",tests:"test",beforeIt:"beforeTest",beforeShould:"beforeTest",beforeTests:"beforeTest"}),h.Unit.TestSuite.include({run:function(e,t,n,s){this._metadata.fullName&&n.call(s,this.klass.STARTED,this);var r=function(r){this.forEach(function(t,i){r&&t.setValuesFromCallbacks&&t.setValuesFromCallbacks(r),t.run(e,i,n,s)},function(){var e=function(){this._metadata.fullName&&n.call(s,this.klass.FINISHED,this),t.call(s)};r&&i.runAllCallbacks?i.runAllCallbacks("after",e,this):e.call(this)},this)},i=this._tests[0];i&&i.runAllCallbacks?i.runAllCallbacks("before",r,this):r.call(this,null)}}),h.extend({Mocking:new e.Module({extend:{ExpectationError:new e.Class(h.Unit.AssertionFailedError),UnexpectedCallError:new e.Class(Error,{initialize:function(e){this.message=""+e}}),__activeStubs__:[],stub:function(t,n,s){var r,i=!1;"new"===t&&(t=n,n=s,s=void 0,i=!0),e.isType(t,"string")&&(s=n,n=t,t=e.ENV);for(var a=this.__activeStubs__,o=a.length;o--;)if(a[o]._object===t&&a[o]._methodName===n){r=a[o];break}return r||(r=new h.Mocking.Stub(t,n)),a.push(r),r.createMatcher(s,i)},removeStubs:function(){for(var e=this.__activeStubs__,t=e.length;t--;)e[t].revoke();this.__activeStubs__=[]},verify:function(){try{for(var e=this.__activeStubs__,t=0,n=e.length;n>t;t++)e[t]._verify()}finally{this.removeStubs()}},Stub:new e.Class({initialize:function(e,t){this._object=e,this._methodName=t,this._original=e[t],this._matchers=[],this._ownProperty=e.hasOwnProperty?e.hasOwnProperty(t):void 0!==this._original,this.activate()},createMatcher:function(t,n){if(void 0!==t&&"function"!=typeof t)return this._object[this._methodName]=t,null;var s=e.Test.Mocking,r=new s.Parameters([new s.AnyArgs],n,t);return this._matchers.push(r),r},activate:function(){var e=this._object,t=this._methodName;if(e[t]===this._original){var n=this,s=function(){var e=this instanceof s;return n._dispatch(this,arguments,e)};e[t]=s}},revoke:function(){if(this._ownProperty)this._object[this._methodName]=this._original;else try{delete this._object[this._methodName]}catch(e){this._object[this._methodName]=void 0}},_dispatch:function(e,t,n){for(var s,r,i=this._matchers,a=[],o=0,c=i.length;c>o;o++)s=i[o],r=s.match(e,t,n),r&&(s.ping(),a.push([s,r]));if(0===a.length&&this._throwUnexpectedCall(e,t,n),a=a.pop(),s=a[0],r=a[1],r.fake)return r.fake.apply(e,t);if(r.exception)throw r.exception;return r.hasOwnProperty("callback")&&(r.callback||this._throwUnexpectedCall(e,t,n),r.callback.apply(r.context,s.nextYieldArgs())),r?s.nextReturnValue():void 0},_throwUnexpectedCall:function(t,n,s){var r;throw r=s?new h.Unit.AssertionMessage("","<?> unexpectedly constructed with arguments:\n(?)",[this._original,e.array(n)]):new h.Unit.AssertionMessage("","<?> unexpectedly received call to "+this._methodName+"() with arguments:\n(?)",[t,e.array(n)]),new h.Mocking.UnexpectedCallError(r)
},_verify:function(){for(var e=0,t=this._matchers.length;t>e;e++)this._matchers[e].verify(this._object,this._methodName,this._original)}})}})}),h.Mocking.extend({Parameters:new e.Class({initialize:function(t,n,s){this._params=e.array(t),this._constructor=n,this._fake=s,this._expected=!1,this._callsMade=0},withNew:function(){return this._constructor=!0,this},on:function(e){return this._target=e,this},given:function(){return this._params=e.array(arguments),this},returns:function(){return this._returnIndex=0,this._returnValues=arguments,this},yields:function(){return this._yieldIndex=0,this._yieldArgs=arguments,this},raises:function(e){return this._exception=e,this},expected:function(){return this._expected=!0,this},atLeast:function(e){return this._expected=!0,this._minimumCalls=e,this},atMost:function(e){return this._expected=!0,this._maximumCalls=e,this},exactly:function(e){return this._expected=!0,this._expectedCalls=e,this},match:function(t,n,r){var i,a,o=e.array(n);if(this._constructor!==r)return!1;if(this._yieldArgs&&("function"==typeof o[o.length-2]?(a=o.pop(),i=o.pop()):"function"==typeof o[o.length-1]&&(a=null,i=o.pop())),void 0!==this._target&&!s.areEqual(this._target,t))return!1;if(!s.areEqual(this._params,o))return!1;var c={};return this._exception&&(c.exception=this._exception),this._yieldArgs&&(c.callback=i,c.context=a),this._fake&&(c.fake=this._fake),c},nextReturnValue:function(){if(!this._returnValues)return void 0;var e=this._returnValues[this._returnIndex];return this._returnIndex=(this._returnIndex+1)%this._returnValues.length,e},nextYieldArgs:function(){if(!this._yieldArgs)return void 0;var e=this._yieldArgs[this._yieldIndex];return this._yieldIndex=(this._yieldIndex+1)%this._yieldArgs.length,e},ping:function(){this._callsMade+=1},toArray:function(){var e=this._params.slice();return this._yieldArgs&&e.push(new h.Mocking.InstanceOf(Function)),e},verify:function(e,t,n){if(this._expected){var s,r=!0;if(0===this._callsMade&&void 0===this._maximumCalls&&void 0===this._expectedCalls?r=!1:void 0!==this._expectedCalls&&this._callsMade!==this._expectedCalls?(s=this._createMessage("exactly"),r=!1):void 0!==this._maximumCalls&&this._callsMade>this._maximumCalls?(s=this._createMessage("at most"),r=!1):void 0!==this._minimumCalls&&this._callsMade<this._minimumCalls&&(s=this._createMessage("at least"),r=!1),!r){var i,a=this._target||e;throw i=this._constructor?new h.Unit.AssertionMessage("Mock expectation not met","<?> expected to be constructed with\n(?)"+(s?"\n"+s:""),[n,this.toArray()]):new h.Unit.AssertionMessage("Mock expectation not met","<?> expected to receive call\n"+t+"(?)"+(s?"\n"+s:""),[a,this.toArray()]),new h.Mocking.ExpectationError(i)}}},_createMessage:function(e){var t=this._callsMade,n="but "+t+" call"+(1===t?" was":"s were")+" made",s={exactly:this._expectedCalls,"at most":this._maximumCalls,"at least":this._minimumCalls};return e+" "+s[e]+" times\n"+n}})}),h.Mocking.Parameters.alias({raising:"raises",returning:"returns",yielding:"yields"}),h.Mocking.extend({Anything:new e.Class({equals:function(){return!0},toString:function(){return"anything()"}}),AnyArgs:new e.Class({equals:function(){return s.ALL_EQUAL},toString:function(){return"anyArgs()"}}),ArrayIncluding:new e.Class({initialize:function(e){this._elements=Array.prototype.slice.call(e)},equals:function(t){if(!e.isType(t,Array))return!1;var n,r=this._elements.length;e:for(;r--;){for(n=t.length;n--;)if(s.areEqual(this._elements[r],t[n]))continue e;return!1}return!0},toString:function(){var e=t.convert(this._elements).replace(/^\[/,"").replace(/\]$/,"");return"arrayIncluding("+e+")"}}),ObjectIncluding:new e.Class({initialize:function(e){this._elements=e},equals:function(t){if(!e.isType(t,Object))return!1;for(var n in this._elements)if(!s.areEqual(this._elements[n],t[n]))return!1;return!0},toString:function(){var e=t.convert(this._elements);return"objectIncluding("+e+")"}}),InstanceOf:new e.Class({initialize:function(e){this._type=e},equals:function(t){return e.isType(t,this._type)},toString:function(){var e=t.convert(this._type);return"instanceOf("+e+")"}}),Matcher:new e.Class({initialize:function(e){this._type=e},equals:function(t){return e.match(this._type,t)},toString:function(){var e=t.convert(this._type);return"match("+e+")"}})}),h.Mocking.extend({DSL:new e.Module({stub:function(){return h.Mocking.stub.apply(h.Mocking,arguments)},expect:function(){var e=h.Mocking.stub.apply(h.Mocking,arguments);return e.expected(),this.addAssertion(),e},anything:function(){return new h.Mocking.Anything},anyArgs:function(){return new h.Mocking.AnyArgs},instanceOf:function(e){return new h.Mocking.InstanceOf(e)},match:function(e){return new h.Mocking.Matcher(e)},arrayIncluding:function(){return new h.Mocking.ArrayIncluding(arguments)},objectIncluding:function(e){return new h.Mocking.ObjectIncluding(e)}})}),h.Unit.TestCase.include(h.Mocking.DSL),h.Unit.mocking=h.Mocking,h.extend({AsyncSteps:new e.Class(e.Module,{define:function(t,n){this.callSuper(t,function(){var s=[t,n].concat(e.array(arguments));this.__enqueue__(s)})},included:function(e){e.include(h.AsyncSteps.Sync),e.blockTransform&&e.extend({blockTransform:function(e){return function(t){this.exec(e,function(e){this.sync(function(){t(e)})})}}})},extend:{Sync:new e.Module({__enqueue__:function(e){if(this.__stepQueue__=this.__stepQueue__||[],this.__stepQueue__.push(e),!this.__runningSteps__){this.__runningSteps__=!0;var t=h.FakeClock.REAL.setTimeout;t(this.method("__runNextStep__"),1)}},__runNextStep__:function(e){if("object"==typeof e&&null!==e)return this.addError(e);var t,n=this.__stepQueue__.shift();{if(n){var s=(n.shift(),n.shift()),r=n.slice(),i=function(){s.apply(this,r)};return r[s.length-1]=this.method("__runNextStep__"),this.exec?(this.exec(i,function(){},this.method("__endSteps__")),void 0):i.call(this)}if(this.__runningSteps__=!1,!this.__stepCallbacks__)return;for(t=this.__stepCallbacks__.length;t--;)this.__stepCallbacks__.shift().call(this)}},__endSteps__:function(e){h.Unit.TestCase.processError(this,e),this.__stepQueue__=[],this.__runNextStep__()},addError:function(){this.callSuper(),this.__endSteps__()},sync:function(e){return this.__runningSteps__?(this.__stepCallbacks__=this.__stepCallbacks__||[],this.__stepCallbacks__.push(e),void 0):e.call(this)}})}}),asyncSteps:function(e){return new this.AsyncSteps(e)}}),h.extend({FakeClock:new e.Module({extend:{API:new e.Singleton({METHODS:["Date","setTimeout","clearTimeout","setInterval","clearInterval"],stub:function(){var e=h.Mocking,t=this.METHODS,n=t.length;for(h.FakeClock.reset();n--;)"Date"===t[n]?e.stub("new",t[n],h.FakeClock.method(t[n])):e.stub(t[n],h.FakeClock.method(t[n]));Date.now=h.FakeClock.REAL.Date.now},reset:function(){return h.FakeClock.reset()},tick:function(e){return h.FakeClock.tick(e)}}),REAL:{},Schedule:new e.Class(r,{nextScheduledAt:function(e){return this.find(function(t){return t.time<=e})}}),Timeout:new e.Class({include:c,initialize:function(e,t,n){this.callback=e,this.interval=t,this.repeat=n},compareTo:function(e){return this.time-e.time},toString:function(){return(this.repeat?"Interval":"Timeout")+"("+this.interval+"):"+this.time}}),reset:function(){this._currentTime=(new Date).getTime(),this._callTime=this._currentTime,this._schedule=new this.Schedule},tick:function(e){this._currentTime+=e;for(var t;t=this._schedule.nextScheduledAt(this._currentTime);)this._run(t);this._callTime=this._currentTime},_run:function(e){this._callTime=e.time,e.callback(),e.repeat?(e.time+=e.interval,this._schedule.rebuild()):this.clearTimeout(e)},_timer:function(e,t,n){var s=new this.Timeout(e,t,n);return s.time=this._callTime+t,this._schedule.add(s),s},Date:function(){var e=new h.FakeClock.REAL.Date;return e.setTime(this._callTime),e},setTimeout:function(e,t){return this._timer(e,t,!1)},setInterval:function(e,t){return this._timer(e,t,!0)},clearTimeout:function(e){this._schedule.remove(e)},clearInterval:function(e){this._schedule.remove(e)}}})}),h.FakeClock.include({clock:h.FakeClock.API}),function(){for(var t=h.FakeClock.API.METHODS,n=t.length;n--;)h.FakeClock.REAL[t[n]]=e.ENV[t[n]]}(),h.extend({Coverage:new e.Class({initialize:function(e){this._module=e,this._methods=new a([]);var t=function(e){for(var t=e.instanceMethods(!1),n=t.length;n--;)this._methods.store(e.instanceMethod(t[n]),0)};t.call(this,e),t.call(this,e.__eigen__())},attach:function(){var t=this._module;u.addObserver(this),e.Method.trace([t,t.__eigen__()])},detach:function(){var t=this._module;e.Method.untrace([t,t.__eigen__()]),u.removeObserver(this)},update:function(e,t){if("call"===e){var n=this._methods.assoc(t.method);n&&n.setValue(n.value+1)}},report:function(){var e=this._methods.entries().sort(function(e,t){return t.value-e.value}),t=this._methods.all(function(e){return e.value>0});return this.printTable(e,function(e,t){return 0===e[1]?["bgred","white"]:t%2===0?["bold"]:[]}),t},printTable:function(e,n){for(var s,r,i=[],e=[["Method","Calls"]].concat(e),a=t,o=e.length;o--;)for(s=e[o].length;s--;)i[s]=i[s]||0,r=""+(void 0===e[o][s]?"":e[o][s]),i[s]=Math.max(r.length,i[s]);for(var c="+",s=i.length;s--;)c="+"+this.repeat("-",i[s]+2)+c;c="  "+c,a.reset(),a.puts(),a.puts(c);var u=function(t,n){var s=e[t];a.reset(),a.print("  ");for(var r=0,o=s.length;o>r;r++)a.reset(),a.print("|"),a.consoleFormat.apply(a,n),a.print(" "+this.pad(s[r],i[r])+" ");a.reset(),a.puts("|")};u.call(this,0,["bold"]),a.reset(),a.puts(c);for(var o=1,l=e.length;l>o;o++){var h=n?n(e[o],o):[];u.call(this,o,h)}a.reset(),a.puts(c)},pad:function(e,t){return e=""+(void 0===e?"":e),e+this.repeat(" ",t-e.length)},repeat:function(e,t){for(var n="";t--;)n+=e;return n}})}),h.extend({Helpers:new e.Module({$R:function(e,t){return new i(e,t)},$w:function(e){return e.split(/\s+/)},forEach:function(e,t,n){for(var s=0,r=e.length;r>s;s++)t.call(n,e[s],s)},its:function(){return new o},map:function(e,t,n){return new s.Collection(e).map(t,n)},repeat:function(e,t,n){for(;e--;)t.call(n)}})}),h.extend({Runner:new e.Class({initialize:function(e){this._settings="string"==typeof e?{format:e}:e||{},this._ui=this.klass.getUI(this._settings)},run:function(e,t){this.prepare(function(){this.start(e,t)},this)},prepare:function(e,t){var n=h.Reporters._registry,s=0,r=!1;for(var i in n)n[i]&&n[i].prepare&&(s+=1,n[i].prepare(function(){s-=1,0===s&&r&&e.call(t)}));r=!0,0===s&&e.call(t)},start:function(e,t){var n=this.getOptions(),s=this._ui.getReporters(n),r=this.getSuite(n);this.setReporter(new h.Reporters.Composite(s)),e&&e.call(t,this);var i=new h.Unit.TestResult,a=h.Unit.TestResult,o=h.Unit.TestSuite,c=h.Unit.TestCase,u=i.addListener(a.CHANGED,function(){var e=i.metadata();this._reporter.update(this.klass.timestamp(e))},this),l=i.addListener(a.FAULT,function(e){this._reporter.addFault(this.klass.timestamp(e.metadata()))},this),d=function(){i.removeListener(a.CHANGED,u),i.removeListener(a.FAULT,l);var e=i.metadata();this._reporter.endSuite(this.klass.timestamp(e))},f=function(e,t){var n=this.klass.timestamp(t.metadata());e===o.STARTED?this._reporter.startContext(n):e===c.STARTED?this._reporter.startTest(n):e===c.FINISHED?this._reporter.endTest(n):e===o.FINISHED&&this._reporter.endContext(n)};this.klass.reportEventId=0,this._reporter.startSuite(this.klass.timestamp(r.metadata(!0))),r.run(i,d,f,this)},addReporter:function(e){var t=this._reporter;t instanceof h.Reporters.Composite||(this._reporter=new h.Reporters.Composite,this._reporter.addReporter(t)),this._reporter.addReporter(e)},setReporter:function(e){this._reporter=e},getOptions:function(){return e.extend(this._ui.getOptions(),this._settings)},getSuite:function(e){var t=e.test;h.Unit.TestCase.resolve();var n=h.Unit.TestCase.suite(t);return h.Unit.TestCase.clear(),n},extend:{timestamp:function(t){return t.eventId=this.reportEventId++,t.timestamp=(new e.Date).getTime(),t},getUI:function(e){return t.BROWSER&&!t.PHANTOM?new h.UI.Browser(e):new h.UI.Terminal(e)},filter:function(e,t){var n,s,r=this.getUI().getOptions().test,i=r.length,a=[];if(0===i)return e;for(;i--;)for(n=e.length;n--;)s=e[n].replace(RegExp(t+"$"),""),r[i].substr(0,s.length)===s&&a.push(e[n]);return a}}}),autorun:function(e,t,n){"function"==typeof e&&(n=t,t=e,e={}),"function"!=typeof t&&(t=void 0,n=void 0);var s=new h.Runner(e);s.run(t,n)}}),l.Test=h});
//@ sourceMappingURL=test.js.map