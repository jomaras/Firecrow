!function(e){var t="object"==typeof exports,n="undefined"==typeof JS?require("./core"):JS,r=n.Enumerable||require("./enumerable").Enumerable,s=n.Comparable||require("./comparable").Comparable;t&&(exports.JS=exports),e(n,r,s,t?exports:n)}(function(e,t,n,r){"use strict";var s=new e.Class("Hash",{include:t||{},extend:{Pair:new e.Class({include:n||{},length:2,setKey:function(e){this[0]=this.key=e},hasKey:function(e){return t.areEqual(this.key,e)},setValue:function(e){this[1]=this.value=e},hasValue:function(e){return t.areEqual(this.value,e)},compareTo:function(e){return this.key.compareTo?this.key.compareTo(e.key):this.key<e.key?-1:this.key>e.key?1:0},hash:function(){var e=s.codeFor(this.key),t=s.codeFor(this.value);return[e,t].sort().join("/")}}),codeFor:function(e){return"object"!=typeof e?e+"":"function"==typeof e.hash?e.hash():""+e}},initialize:function(t){if(this.clear(),!e.isType(t,Array))return this.setDefault(t);for(var n=0,r=t.length;r>n;n+=2)this.store(t[n],t[n+1])},forEach:function(e,n){if(!e)return this.enumFor("forEach");e=t.toFn(e);var r,s,i;for(r in this._buckets)if(this._buckets.hasOwnProperty(r))for(s=this._buckets[r],i=s.length;i--;)e.call(n,s[i]);return this},_bucketForKey:function(e,t){var n=this.klass.codeFor(e),r=this._buckets[n];return!r&&t&&(r=this._buckets[n]=[]),r},_indexInBucket:function(e,t){for(var n=e.length,r=!!this._compareByIdentity;n--;)if(r?e[n].key===t:e[n].hasKey(t))return n;return-1},assoc:function(e,t){var n,r,s;return(n=this._bucketForKey(e,t))?(r=this._indexInBucket(n,e),r>-1?n[r]:t?(this.size+=1,this.length+=1,s=new this.klass.Pair,s.setKey(e),n.push(s),s):null):null},rassoc:function(e){var t=this.key(e);return t?this.assoc(t):null},clear:function(){this._buckets={},this.length=this.size=0},compareByIdentity:function(){return this._compareByIdentity=!0,this},comparesByIdentity:function(){return!!this._compareByIdentity},setDefault:function(e){return this._default=e,this},getDefault:function(e){return"function"==typeof this._default?this._default(this,e):this._default||null},equals:function(t){if(!e.isType(t,s)||this.length!==t.length)return!1;var n=!0;return this.forEach(function(e){if(n){var r=t.assoc(e.key);null!==r&&r.hasValue(e.value)||(n=!1)}}),n},hash:function(){var e=[];return this.forEach(function(t){e.push(t.hash())}),e.sort().join("")},fetch:function(e,t,n){var r=this.assoc(e);if(r)return r.value;if(void 0===t)throw Error("key not found");return"function"==typeof t?t.call(n,e):t},forEachKey:function(e,n){return e?(e=t.toFn(e),this.forEach(function(t){e.call(n,t.key)}),this):this.enumFor("forEachKey")},forEachPair:function(e,n){return e?(e=t.toFn(e),this.forEach(function(t){e.call(n,t.key,t.value)}),this):this.enumFor("forEachPair")},forEachValue:function(e,n){return e?(e=t.toFn(e),this.forEach(function(t){e.call(n,t.value)}),this):this.enumFor("forEachValue")},get:function(e){var t=this.assoc(e);return t?t.value:this.getDefault(e)},hasKey:function(e){return!!this.assoc(e)},hasValue:function(e){var n=!1,r=!!this._compareByIdentity;return this.forEach(function(s){n||(r?e===s.value:t.areEqual(e,s.value))&&(n=!0)}),n},invert:function(){var e=new this.klass;return this.forEach(function(t){e.store(t.value,t.key)}),e},isEmpty:function(){for(var e in this._buckets)if(this._buckets.hasOwnProperty(e)&&this._buckets[e].length>0)return!1;return!0},keepIf:function(e,t){return this.removeIf(function(){return!e.apply(t,arguments)})},key:function(e){var n=null;return this.forEach(function(r){!n&&t.areEqual(e,r.value)&&(n=r.key)}),n},keys:function(){var e=[];return this.forEach(function(t){e.push(t.key)}),e},merge:function(e,t,n){var r=new this.klass;return r.update(this),r.update(e,t,n),r},rehash:function(){var e=new this.klass;e._buckets=this._buckets,this.clear(),this.update(e)},remove:function(e,t){void 0===t&&(t=null);var n,r,s;return(n=this._bucketForKey(e))?(r=this._indexInBucket(n,e),0>r?"function"==typeof t?this.fetch(e,t):this.getDefault(e):(s=n[r].value,this._delete(n,r),this.size-=1,this.length-=1,0===n.length&&delete this._buckets[this.klass.codeFor(e)],s)):"function"==typeof t?this.fetch(e,t):this.getDefault(e)},_delete:function(e,t){e.splice(t,1)},removeIf:function(e,n){if(!e)return this.enumFor("removeIf");e=t.toFn(e);var r=[];this.forEach(function(t){e.call(n,t)&&r.push(t.key)},this);for(var s=r.length;s--;)this.remove(r[s]);return this},replace:function(e){this.clear(),this.update(e)},shift:function(){var e=this.keys();if(0===e.length)return this.getDefault();var t=this.assoc(e[0]);return this.remove(t.key),t},store:function(e,t){return this.assoc(e,!0).setValue(t),t},toString:function(){return"Hash:{"+this.map(function(e){return""+e.key+"=>"+e.value}).join(",")+"}"},update:function(e,t,n){var r="function"==typeof t;e.forEach(function(e){var s=e.key,i=e.value;r&&this.hasKey(s)&&(i=t.call(n,s,this.get(s),i)),this.store(s,i)},this)},values:function(){var e=[];return this.forEach(function(t){e.push(t.value)}),e},valuesAt:function(){for(var e=arguments.length,t=[];e--;)t.push(this.get(arguments[e]));return t}});s.alias({includes:"hasKey",index:"key",put:"store"});var i=new e.Class("OrderedHash",s,{assoc:function(e,t){var n=s.prototype.assoc,r=n.call(this,e,!1);if(r||!t)return r;var i=n.call(this,e,!0);return this._first?(this._last._next=i,i._prev=this._last,this._last=i):this._first=this._last=i,i},clear:function(){this.callSuper(),this._first=this._last=null},_delete:function(e,t){var n=e[t];return n._prev&&(n._prev._next=n._next),n._next&&(n._next._prev=n._prev),n===this._first&&(this._first=n._next),n===this._last&&(this._last=n._prev),this.callSuper()},forEach:function(e,n){if(!e)return this.enumFor("forEach");e=t.toFn(e);for(var r=this._first;r;)e.call(n,r),r=r._next},rehash:function(){var e=this._first;for(this.clear();e;)this.store(e.key,e.value),e=e._next}});r.Hash=s,r.OrderedHash=i});
//@ sourceMappingURL=hash.js.map