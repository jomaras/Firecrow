!function(e){var t="object"==typeof exports,n="undefined"==typeof JS?require("./core"):JS,r=n.Enumerable||require("./enumerable").Enumerable,s=n.Observable||require("./observable").Observable;t&&(exports.JS=exports),e(n,r,s,t?exports:n)}(function(e,t,n,r){"use strict";var s=new e.Class("Command",{initialize:function(e){"function"==typeof e&&(e={execute:e}),this._functions=e,this._stack=this._functions.stack||null},execute:function(e){this._stack&&this._stack._restart();var t=this._functions.execute;t&&t.apply(this),this._stack&&e!==!1&&this._stack.push(this)},undo:function(){var e=this._functions.undo;e&&e.apply(this)},extend:{Stack:new e.Class({include:[n||{},t||{}],initialize:function(e){e=e||{},this._redo=e.redo||null,this.clear()},forEach:function(e,n){if(!e)return this.enumFor("forEach");e=t.toFn(e);for(var r=0,s=this._stack.length;s>r;r++)void 0!==this._stack[r]&&e.call(n,this._stack[r],r);return this},clear:function(){this._stack=[],this.length=this.pointer=0},_restart:function(){0===this.pointer&&this._redo&&this._redo.execute&&this._redo.execute()},push:function(e){this._stack.splice(this.pointer,this.length),this._stack.push(e),this.length=this.pointer=this._stack.length,this.notifyObservers&&this.notifyObservers(this)},stepTo:function(e){if(!(0>e||e>this.length)){var t,n;switch(!0){case e>this.pointer:for(t=this.pointer,n=e;n>t;t++)this._stack[t].execute(!1);break;case e<this.pointer:if(this._redo&&this._redo.execute)for(this._redo.execute(),t=0,n=e;n>t;t++)this._stack[t].execute(!1);else for(t=0,n=this.pointer-e;n>t;t++)this._stack[this.pointer-t-1].undo()}this.pointer=e,this.notifyObservers&&this.notifyObservers(this)}},undo:function(){this.stepTo(this.pointer-1)},redo:function(){this.stepTo(this.pointer+1)}})}});r.Command=s});
//@ sourceMappingURL=command.js.map