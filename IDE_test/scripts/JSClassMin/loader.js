var JS=void 0===this.JS?{}:this.JS;JS.Date=Date,function(e){var t="object"==typeof this.global?this.global:this,r="object"==typeof exports;r?(exports.JS=exports,JS=exports):t.JS=JS,e(t,JS)}(function(global,exports){"use strict";var Package=function(e){Package._index(this),this._loader=e,this._names=new OrderedSet,this._deps=new OrderedSet,this._uses=new OrderedSet,this._styles=new OrderedSet,this._observers={},this._events={}};Package.displayName="Package",Package.toString=function(){return Package.displayName},Package.log=function(e){exports.debug&&"undefined"!=typeof window&&("object"==typeof global.runtime&&runtime.trace(e),global.console&&console.info&&console.info(e))};var resolve=function(e){if(/^https?:/.test(e))return e;var t=exports.ROOT;return t&&(e=(t+"/"+e).replace(/\/+/g,"/")),e},OrderedSet=function(e){if(this._members=this.list=[],this._index={},e)for(var t=0,r=e.length;r>t;t++)this.push(e[t])};OrderedSet.prototype.push=function(e){var t=void 0!==e.id?e.id:e,r=this._index;r.hasOwnProperty(t)||(r[t]=this._members.length,this._members.push(e))};var Deferred=Package.Deferred=function(){this._status="deferred",this._value=null,this._callbacks=[]};Deferred.prototype.callback=function(e,t){"succeeded"===this._status?e.call(t,this._value):this._callbacks.push([e,t])},Deferred.prototype.succeed=function(e){this._status="succeeded",this._value=e;for(var t;t=this._callbacks.shift();)t[0].call(t[1],e)},Package.ENV=exports.ENV=global,Package.onerror=function(e){throw e},Package._throw=function(e){Package.onerror(Error(e))};for(var instance=Package.prototype,methods=[["requires","_deps"],["uses","_uses"]],i=methods.length;i--;)(function(e){var t=e[0],r=e[1];instance[t]=function(){var e,t=arguments.length;for(e=0;t>e;e++)this[r].push(arguments[e]);return this}})(methods[i]);instance.provides=function(){var e,t=arguments.length;for(e=0;t>e;e++)this._names.push(arguments[e]),Package._getFromCache(arguments[e]).pkg=this;return this},instance.styling=function(){for(var e=0,t=arguments.length;t>e;e++)this._styles.push(resolve(arguments[e]))},instance.setup=function(e){return this._onload=e,this},instance._on=function(e,t,r){if(this._events[e])return t.call(r);var n=this._observers[e]=this._observers[e]||[];n.push([t,r]),this._load()},instance._fire=function(e){if(this._events[e])return!1;this._events[e]=!0;var t=this._observers[e];if(!t)return!0;delete this._observers[e];for(var r=0,n=t.length;n>r;r++)t[r][0].call(t[r][1]);return!0},instance._isLoaded=function(e){if(!e&&void 0!==this.__isLoaded)return this.__isLoaded;for(var t,r,n=this._names.list,a=n.length;a--;)if(t=n[a],r=Package._getObject(t,this._exports),void 0===r)return e?Package._throw("Expected package at "+this._loader+" to define "+t):this.__isLoaded=!1;return this.__isLoaded=!0},instance._load=function(){if(this._fire("request")){this._isLoaded()||this._prefetch();var e=this._deps.list.concat(this._uses.list),t=this._source||[],r=(this._loader||{}).length,n=this;Package.when({load:e}),Package.when({complete:this._deps.list},function(){Package.when({complete:e,load:[this]},function(){this._fire("complete")},this);var a=function(e){if(0===r)return i(e);r-=1;var s=n._loader.length-r-1;Package.loader.loadFile(n._loader[s],a,t[s])},i=function(e){n._exports=e,n._onload&&n._onload(),n._isLoaded(!0),n._fire("load")};if(this._isLoaded())return this._fire("download"),this._fire("load");if(void 0===this._loader)return Package._throw("No load path found for "+this._names.list[0]);if("function"==typeof this._loader?this._loader(i):a(),Package.loader.loadStyle){for(var s=this._styles.list,o=s.length;o--;)Package.loader.loadStyle(s[o]);this._fire("download")}},this)}},instance._prefetch=function(){if(!this._source&&this._loader instanceof Array&&Package.loader.fetch){this._source=[];for(var e=0,t=this._loader.length;t>e;e++)this._source[e]=Package.loader.fetch(this._loader[e])}},instance.toString=function(){return"Package:"+this._names.list.join(",")},Package.when=function(e,t,r){var n,a,i,s=[],o={};for(n in e)if(e.hasOwnProperty(n))for(o[n]=[],a=new OrderedSet(e[n]),i=a.list.length;i--;)s.push([n,a.list[i],i]);var c=i=s.length;if(0===c)return t&&t.call(r,o);for(;i--;)(function(e){var n=Package._getByName(e[1]);n._on(e[0],function(){o[e[0]][e[2]]=Package._getObject(e[1],n._exports),c-=1,0===c&&t&&t.call(r,o)})})(s[i])};var globalPackage=(global.JS||{}).Package||{};Package._autoIncrement=globalPackage._autoIncrement||1,Package._indexByPath=globalPackage._indexByPath||{},Package._indexByName=globalPackage._indexByName||{},Package._autoloaders=globalPackage._autoloaders||[],Package._index=function(e){e.id=this._autoIncrement,this._autoIncrement+=1},Package._getByPath=function(e){var t=""+e,r=this._indexByPath[t];return r?r:("string"==typeof e&&(e=[].slice.call(arguments)),r=this._indexByPath[t]=new this(e))},Package._getByName=function(e){if("string"!=typeof e)return e;var t=this._getFromCache(e);if(t.pkg)return t.pkg;var r=this._manufacture(e);if(r)return r;var n=new this;return n.provides(e),n},Package.remove=function(e){var t=this._getByName(e);delete this._indexByName[e],delete this._indexByPath[t._loader]},Package._autoload=function(e,t){this._autoloaders.push([e,t])},Package._manufacture=function(e){var t,r,n,a,i=this._autoloaders,s=i.length;for(t=0;s>t;t++)if(n=i[t],n[0].test(e)){a=n[1].from,"string"==typeof a&&(a=this._convertNameToPath(a));var o=new this([a(e)]);if(o.provides(e),a=n[1].require)for(a=[].concat(a),r=a.length;r--;)o.requires(e.replace(n[0],a[r]));return o}return null},Package._convertNameToPath=function(e){return function(t){return e.replace(/\/?$/,"/")+t.replace(/([a-z])([A-Z])/g,function(e,t,r){return t+"_"+r}).replace(/\./g,"/").toLowerCase()+".js"}},Package._getFromCache=function(e){return this._indexByName[e]=this._indexByName[e]||{}},Package._getObject=function(e,t){if("string"!=typeof e)return void 0;var r=t?{}:this._getFromCache(e);if(void 0!==r.obj)return r.obj;for(var n,a=t||this.ENV,i=e.split(".");n=i.shift();)a=a&&a[n];return t&&void 0===a?this._getObject(e):r.obj=a},Package.CommonJSLoader={usable:function(){return"function"==typeof require&&"object"==typeof exports},__FILE__:function(){return this._currentPath},loadFile:function(e,t){var r,n;"undefined"!=typeof process?(n=e.replace(/\.[^\.]+$/g,""),r=require("path").resolve(n)):"undefined"!=typeof phantom&&(r=phantom.libraryPath.replace(/\/$/,"")+"/"+e.replace(/^\//,"")),this._currentPath=r+".js";var n=require(r);return t(n),n}},Package.BrowserLoader={HOST_REGEX:/^(https?\:)?\/\/[^\/]+/i,usable:function(){return!!Package._getObject("window.document.getElementsByTagName")&&"undefined"==typeof phantom},__FILE__:function(){var e=document.getElementsByTagName("script"),t=e[e.length-1].src,r=window.location.href;return/^\w+\:\/+/.test(t)?t:/^\//.test(t)?window.location.origin+t:r.replace(/[^\/]*$/g,"")+t},cacheBust:function(e){if(exports.cache!==!1)return e;var t=(new JS.Date).getTime();return e+(/\?/.test(e)?"&":"?")+t},fetch:function(e){var t=e;e=this.cacheBust(e),this.HOST=this.HOST||this.HOST_REGEX.exec(window.location.href);var r=this.HOST_REGEX.exec(e);if(!this.HOST||r&&r[0]!==this.HOST[0])return null;Package.log("[FETCH] "+e);var n=new Package.Deferred,a=this,i=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;return i.open("GET",e,!0),i.onreadystatechange=function(){4===i.readyState&&(i.onreadystatechange=a._K,n.succeed(i.responseText+"\n//@ sourceURL="+t),i=null)},i.send(null),n},loadFile:function(e,t,r){r||(e=this.cacheBust(e));var n=this,a=document.getElementsByTagName("head")[0],i=document.createElement("script");return i.type="text/javascript",r?r.callback(function(r){Package.log("[EXEC]  "+e);var n=Function("code","eval(code)");n(r),t()}):(Package.log("[LOAD] "+e),i.src=e,i.onload=i.onreadystatechange=function(){var e=i.readyState,r=i.status;(!e||"loaded"===e||"complete"===e||4===e&&200===r)&&(t(),i.onload=i.onreadystatechange=n._K,a=null,i=null)},a.appendChild(i),void 0)},loadStyle:function(e){var t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=this.cacheBust(e),document.getElementsByTagName("head")[0].appendChild(t)},_K:function(){}},Package.RhinoLoader={usable:function(){return"object"==typeof java&&"function"==typeof require},__FILE__:function(){return this._currentPath},loadFile:function(e,t){var r=java.lang.System.getProperty("user.dir"),n=e.replace(/\.[^\.]+$/g,""),a=""+new java.io.File(r,n);this._currentPath=a+".js";var n=require(a);return t(n),n}},Package.ServerLoader={usable:function(){return"function"==typeof Package._getObject("load")&&"function"==typeof Package._getObject("version")},__FILE__:function(){return this._currentPath},loadFile:function(e,t){this._currentPath=e,load(e),t()}},Package.WshLoader={usable:function(){return!!Package._getObject("ActiveXObject")&&!!Package._getObject("WScript")},__FILE__:function(){return this._currentPath},loadFile:function(path,fireCallbacks){this._currentPath=path;var fso=new ActiveXObject("Scripting.FileSystemObject"),file,runner;try{file=fso.OpenTextFile(path),runner=function(){eval(file.ReadAll())},runner(),fireCallbacks()}finally{try{file&&file.Close()}catch(e){}}}},Package.XULRunnerLoader={jsloader:"@mozilla.org/moz/jssubscript-loader;1",cssservice:"@mozilla.org/content/style-sheet-service;1",ioservice:"@mozilla.org/network/io-service;1",usable:function(){try{var e=(Components||{}).classes;return!!(e&&e[this.jsloader]&&e[this.jsloader].getService)}catch(t){return!1}},setup:function(){var e=Components.classes,t=Components.interfaces;this.ssl=e[this.jsloader].getService(t.mozIJSSubScriptLoader),this.sss=e[this.cssservice].getService(t.nsIStyleSheetService),this.ios=e[this.ioservice].getService(t.nsIIOService)},loadFile:function(e,t){Package.log("[LOAD] "+e),this.ssl.loadSubScript(e),t()},loadStyle:function(e){var t=this.ios.newURI(e,null,null);this.sss.loadAndRegisterSheet(t,this.sss.USER_SHEET)}};var candidates=[Package.XULRunnerLoader,Package.RhinoLoader,Package.BrowserLoader,Package.CommonJSLoader,Package.ServerLoader,Package.WshLoader],n=candidates.length,i,candidate;for(i=0;n>i;i++)if(candidate=candidates[i],candidate.usable()){Package.loader=candidate,candidate.setup&&candidate.setup();break}var DSL={__FILE__:function(){return Package.loader.__FILE__()},pkg:function(e,t){var r=t?Package._getByPath(t):Package._getByName(e);return r.provides(e),r},file:function(){for(var e=[],t=arguments.length;t--;)e[t]=resolve(arguments[t]);return Package._getByPath.apply(Package,e)},load:function(e,t){Package.loader.loadFile(e,t)},autoload:function(e,t){Package._autoload(e,t)}};DSL.files=DSL.file,DSL.loader=DSL.file;var packages=function(e){e.call(DSL)},parseLoadArgs=function(e){for(var t=[],r=0;"string"==typeof e[r];)t.push(e[r]),r+=1;return{files:t,callback:e[r],context:e[r+1]}};exports.load=function(){var e=parseLoadArgs(arguments),t=e.files.length,r=function(n){return n===t?e.callback.call(e.context):(Package.loader.loadFile(e.files[n],function(){r(n+1)}),void 0)};r(0)},exports.require=function(){var e=parseLoadArgs(arguments);return Package.when({complete:e.files},function(t){e.callback&&e.callback.apply(e.context,t&&t.complete)}),this},exports.Package=Package,exports.Packages=exports.packages=packages,exports.DSL=DSL}),function(){var E="object"==typeof exports,P=E?exports:JS,Package=P.Package;P.packages(function(){with(this){Package.ENV.JSCLASS_PATH=Package.ENV.JSCLASS_PATH||__FILE__().replace(/[^\/]*$/g,"");var PATH=Package.ENV.JSCLASS_PATH;/\/$/.test(PATH)||(PATH+="/");var module=function(e){return file(PATH+e+".js")};module("core").provides("JS","JS.Module","JS.Class","JS.Method","JS.Kernel","JS.Singleton","JS.Interface");var test="JS.Test.Unit";module("test").provides("JS.Test","JS.Test.Context","JS.Test.Mocking","JS.Test.FakeClock","JS.Test.AsyncSteps","JS.Test.Helpers",test,test+".Assertions",test+".TestCase",test+".TestSuite",test+".TestResult").requires("JS.Module","JS.Class","JS.Console","JS.DOM","JS.Enumerable","JS.SortedSet","JS.Range","JS.Hash","JS.MethodChain","JS.Comparable","JS.StackTrace").styling(PATH+"assets/testui.css"),module("dom").provides("JS.DOM","JS.DOM.Builder").requires("JS.Class"),module("console").provides("JS.Console").requires("JS.Module","JS.Enumerable"),module("comparable").provides("JS.Comparable").requires("JS.Module"),module("constant_scope").provides("JS.ConstantScope").requires("JS.Module"),module("forwardable").provides("JS.Forwardable").requires("JS.Module"),module("enumerable").provides("JS.Enumerable").requires("JS.Module","JS.Class"),module("deferrable").provides("JS.Deferrable").requires("JS.Module"),module("observable").provides("JS.Observable").requires("JS.Module"),module("hash").provides("JS.Hash","JS.OrderedHash").requires("JS.Class","JS.Enumerable","JS.Comparable"),module("range").provides("JS.Range").requires("JS.Class","JS.Enumerable","JS.Hash"),module("set").provides("JS.Set","JS.HashSet","JS.OrderedSet","JS.SortedSet").requires("JS.Class","JS.Enumerable","JS.Hash"),module("linked_list").provides("JS.LinkedList","JS.LinkedList.Doubly","JS.LinkedList.Doubly.Circular").requires("JS.Class","JS.Enumerable"),module("command").provides("JS.Command","JS.Command.Stack").requires("JS.Class","JS.Enumerable","JS.Observable"),module("decorator").provides("JS.Decorator").requires("JS.Module","JS.Class"),module("method_chain").provides("JS.MethodChain").requires("JS.Module","JS.Kernel"),module("proxy").provides("JS.Proxy","JS.Proxy.Virtual").requires("JS.Module","JS.Class"),module("stack_trace").provides("JS.StackTrace").requires("JS.Module","JS.Singleton","JS.Observable","JS.Enumerable","JS.Console"),module("state").provides("JS.State").requires("JS.Module","JS.Class"),module("tsort").provides("JS.TSort").requires("JS.Module").requires("JS.Class").requires("JS.Hash")}})}();
//@ sourceMappingURL=loader.js.map