<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="UTF-8"/>
    <script>
        var Native = function(options){
            options = options || {};
            var name = options.name;
            var legacy = options.legacy;
            var protect = options.protect;
            var methods = options.implement;
            var generics = options.generics;
            var initialize = options.initialize;
            var afterImplement = options.afterImplement || function(){};
            var object = initialize || legacy;
            generics = generics !== false;

            object.constructor = Native;
            object.$family = {name: 'native'};
            if (legacy && initialize) object.prototype = legacy.prototype;
            object.prototype.constructor = object;

            if (name){
                var family = name.toLowerCase();
                object.prototype.$family = {name: family};
                Native.typize(object, family);
            }

            var add = function(obj, name, method, force){
                if (!protect || force || !obj.prototype[name]) obj.prototype[name] = method;
                if (generics) Native.genericize(obj, name, protect);
                afterImplement.call(obj, name, method);
                return obj;
            };

            object.alias = function(a1, a2, a3){
                if (typeof a1 == 'string'){
                    var pa1 = this.prototype[a1];
                    if ((a1 = pa1)) return add(this, a2, a1, a3);
                }
                for (var a in a1) this.alias(a, a1[a], a2);
                return this;
            };

            object.implement = function(a1, a2, a3){
                if (typeof a1 == 'string') return add(this, a1, a2, a3);
                for (var p in a1) add(this, p, a1[p], a2);
                return this;
            };

            if (methods) object.implement(methods);

            return object;
        };

        Native.genericize = function(object, property, check){
            if ((!check || !object[property]) && typeof object.prototype[property] == 'function') object[property] = function(){
                var args = Array.prototype.slice.call(arguments);
                return object.prototype[property].apply(args.shift(), args);
            };
        };

        Native.implement = function(objects, properties){
            for (var i = 0, l = objects.length; i < l; i++) objects[i].implement(properties);
        };

        Native.typize = function(object, family){
            if (!object.type) object.type = function(item){
                return ($type(item) === family);
            };
        };

        var fNative = new Native({name: "Function", initialize: Function, protect: true});

        Function.implement({

            extend: function(properties){
                for (var property in properties)
                    this[property] = properties[property];
                return this;
            },
            create: function(options){
                var self = this;
                options = options || {};
                return function(event){
                    var args = options.arguments;
                    args = (args != undefined) ? $splat(args) : Array.slice(arguments, (options.event) ? 1 : 0);
                    if (options.event) args = [event || window.event].extend(args);
                    var returns = function(){
                        return self.apply(options.bind || null, args);
                    };
                    if (options.delay) return setTimeout(returns, options.delay);
                    if (options.periodical) return setInterval(returns, options.periodical);
                    if (options.attempt) return $try(returns);
                    return returns();
                };
            },

            run: function(args, bind){
                return this.apply(bind, $splat(args));
            },

            pass: function(args, bind){
                return this.create({bind: bind, arguments: args});
            },

            bind: function(bind, args){
                return this.create({bind: bind, arguments: args});
            },

            bindWithEvent: function(bind, args){
                return this.create({bind: bind, arguments: args, event: true});
            },

            attempt: function(args, bind){
                return this.create({bind: bind, arguments: args, attempt: true})();
            },

            delay: function(delay, bind, args){
                return this.create({bind: bind, arguments: args, delay: delay})();
            },

            periodical: function(periodical, bind, args){
                return this.create({bind: bind, arguments: args, periodical: periodical})();
            }
        });

        function Class(params){

            if (params instanceof Function) params = {initialize: params};

            var newClass = function(){
                if (newClass._prototyping) return this;
                var value = (this.initialize) ? this.initialize.apply(this, arguments) : this;
                return value;
            }.extend(this);

            newClass.implement(params);

            newClass.constructor = Class;
            newClass.prototype.constructor = newClass;

            return newClass;
        };

        new Native({name: 'Class', initialize: Class}).extend({

            instantiate: function(F){
                F._prototyping = true;
                var proto = new F;
                delete F._prototyping;
                return proto;
            },

            wrap: function(self, key, method){
                if (method._origin) method = method._origin;

                return function(){
                    if (method._protected && this._current == null) throw new Error('The method "' + key + '" cannot be called.');
                    var caller = this.caller, current = this._current;
                    this.caller = current; this._current = arguments.callee;
                    var result = method.apply(this, arguments);
                    this._current = current; this.caller = caller;
                    return result;
                }.extend({_owner: self, _origin: method, _name: key});

            }

        });

        Class.implement({

            implement: function(key, value){

                if (typeof key == 'object'){
                    for (var p in key) this.implement(p, key[p]);
                    return this;
                }


                var proto = this.prototype;

                switch (typeof value){

                    case 'function':
                        if (value._hidden) return this;
                        proto[key] = Class.wrap(this, key, value);
                        break;

                    case 'object':
                        var previous = proto[key];
                        if ($type(previous) == 'object') $mixin(previous, value);
                        else proto[key] = $unlink(value);
                        break;

                    case 'array':
                        proto[key] = $unlink(value);
                        break;

                    default: proto[key] = value;

                }

                return this;

            }

        });

        var Chain = new Class({
            chain: function(){
                return 3;
            }
        });

        var chain = new Chain();

        var a1= chain.chain();
        a1;
    </script>
</head>
<body>

</body>
</html>