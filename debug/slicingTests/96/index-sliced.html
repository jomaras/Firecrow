<!DOCTYPE html>
<html>
<head>
    <title>MooTools break-down</title>
    <meta charset="UTF-8"/>
</head>
<body>
<h1> MooTools break down </h1>
<div id="mainContentContainer"></div>
<script>
    var Native = function(options)
    {
        var protect = options.protect;
        var initialize = options.initialize;
        var afterImplement = options.afterImplement;
        var object = initialize;
        var add = function(obj, name, method, force)
        {
            if(!protect || force || !(obj.prototype[name]))
            {
                obj.prototype[name] = method;
            }

            if(afterImplement)
            afterImplement.call(obj, name, method);
        };
        object.alias = function(a1, a2, a3)
        {
            if(typeof a1 == 'string')
            {
                var pa1 = this.prototype[a1];
                if(a1 = pa1)
                {
                    var res = add(this, a2, a1, a3);
                }
            }
        };
        object.implement = function(a1, a2, a3)
        {
            for(var p in a1)
            {
                add(this, p, a1[p], a2);
            }
        };
        return object;
    };
    Native.implement = function(objects, properties)
    {
        for(var i = 0, l = objects.length;i < l;i++)
        {
            objects[i].implement(properties);
        }
    };
    new Native({
        initialize: Array,
        protect: true
    });
    new Native({
        initialize: Function,
        protect: true
    });
    var Hash = new Native({
        initialize: function(object)
        {}
    });
    Array.alias('forEach', 'each');
    function $pick()
    {
        for(var i = 0, l = arguments.length;i < l;i++)
        {
            if(arguments[i] != undefined)
            {
                return arguments[i];
            }
        }
    }
    var Window = new Native({
        initialize: function(win)
        {}
    });
    var Document = new Native({
        initialize: function(doc)
        {},
        afterImplement: function(property, value)
        {
            document[property] = Document.Prototype[property] = value;
        }
    });
    Document.Prototype = {};
    Array.implement({
        contains: function(item, from)
        {}
    });
    Function.implement({
        create: function(options)
        {
            var self = this;
            options = options;
            var createdFunction = function(event)
            {
                var args = Array.slice(arguments, 0);
                var returnValue = function()
                {
                    var applyArg;
                    if(options.bind)
                    {
                        applyArg = options.bind;
                    }

                    return self.apply(applyArg, args);
                };
                return returnValue();
            };
            return createdFunction;
        }
    });
    Hash.implement({
        get: function(key)
        {}
    });
    if(window.$ == null)
    {
        Window.implement({
            $: function(el, nc)
            {}
        });
    }

    var storage = {};
    var get = function(uid)
    {
        var arg = storage[uid];
        if(!arg)
        {
            arg = storage[uid] = {};
        }

        return arg;
    };
    Native.implement([Window, Document], {
        addListener: function(type, fn)
        {
            this.addEventListener(type, fn, false);
        },
        removeListener: function(type, fn)
        {},
        retrieve: function(property, dflt)
        {
            var storage = get(this.uid), prop = storage[property];
            if(dflt != undefined && prop == undefined)
            {
                prop = storage[property] = dflt;
            }

            return $pick(prop);
        },
        addEvent: function(type, fn)
        {
            var events = this.retrieve('events', {});
            if(!(events[type]))
            {
                events[type] = {
                    'keys': []
                };
            }

            events[type].keys.push(fn);
            var realType = type, self = this;
            var defn = function()
            {
                return fn.call(self);
            };
            if(Element.NativeEvents[realType])
            {
                this.addListener(realType, defn);
            }
        },
        fireEvent: function(type, args, delay)
        {
            var events = this.retrieve('events');
            events[type].keys.each(function(fn)
            {
                fn.create({
                    'bind': this
                })();
            }, this);
        }
    });
    Element.NativeEvents = {DOMContentLoaded: 1};
    document.addEvent('DOMContentLoaded', function()
    {
        document.fireEvent('domready');
    });
</script>
<script>
    document.addEvent('domready', function()
    {
        var contentContainer = document.getElementById('mainContentContainer');
        contentContainer.textContent += 'Hello from MooTools DOM ready';
    });
</script>

</body>
</html>