<!DOCTYPE html>
<html>
<head>
    <title>Firecrow - Debug Test Pages</title>
    <script>
        var FBL = undefined;
    </script>
    <script src="../chrome/content/Firecrow/initFBL.js"></script>

    <script src="pages/modelMapping.js"></script>
    <script src="file:///C:/GitWebStorm/CodeModels/evaluation/fullPages/12-idt/codeModel/featureModel.js"></script>
    <script src="file:///C:/Users/Josip/AppData/Roaming/Mozilla/Firefox/Profiles/x0ne0m8u.default/Firecrow/profiles/http%253A%252F%252Flocalhost%252FFirecrow%252Fevaluation%252FfullPages%252F12-idt%252F/1392112853438-executions.json" type="text/javascript"></script>

    <script src="../chrome/content/Firecrow/helpers/valueTypeHelper.js"></script>
    <script src="../chrome/content/Firecrow/helpers/htmlHelper.js"></script>
    <script src="../chrome/content/Firecrow/helpers/ASTHelper.js"></script>
    <script src="../chrome/content/Firecrow/helpers/htmlHelper.js"></script>
    <script src="../chrome/content/Firecrow/helpers/UriHelper.js"></script>
    <script src="../chrome/content/Firecrow/helpers/TimerHelper.js"></script>
    <script src="../chrome/content/Firecrow/helpers/esprima.js"></script>

    <script src="../chrome/content/Firecrow/scenarioGenerator/Event.js"></script>
    <script src="../chrome/content/Firecrow/scenarioGenerator/Scenario.js"></script>

    <script src="../chrome/content/Firecrow/scenarioGenerator/symbolic/NumberRange.js"></script>
    <script src="../chrome/content/Firecrow/scenarioGenerator/symbolic/StringConstraint.js"></script>
    <script src="../chrome/content/Firecrow/scenarioGenerator/symbolic/Expression.js"></script>
    <script src="../chrome/content/Firecrow/scenarioGenerator/symbolic/PathConstraint.js"></script>
    <script src="../chrome/content/Firecrow/scenarioGenerator/symbolic/SymbolicExecutor.js"></script>
    <script src="../chrome/content/Firecrow/scenarioGenerator/symbolic/ConstraintResolver.js"></script>

    <script src="../chrome/content/Firecrow/dependencyGraph/dependencyHighlighter.js"></script>
    <script src="../chrome/content/Firecrow/dependencyGraph/node.js"></script>
    <script src="../chrome/content/Firecrow/dependencyGraph/edge.js"></script>
    <script src="../chrome/content/Firecrow/dependencyGraph/dependencyGraph.js"></script>
    <script src="../chrome/content/Firecrow/dependencyGraph/slicingCriterion.js"></script>
    <script src="../chrome/content/Firecrow/dependencyGraph/inclusionFinder.js"></script>
    <script src="../chrome/content/Firecrow/dependencyGraph/dependencyPostprocessor.js"></script>
    <script src="../chrome/content/Firecrow/codeMarkupGenerator/codeMarkupGenerator.js"></script>
    <script src="../chrome/content/Firecrow/codeMarkupGenerator/codeTextGenerator.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/commands/CommandGenerator.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/commands/Command.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/model/FcValue.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/object/Object.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/object/ObjectPrototype.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/object/ObjectFunction.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/object/ObjectExecutor.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/globalObject/GlobalObject.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/globalObject/GlobalObjectExecutor.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/array/Array.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/array/ArrayCallbackExecutor.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/array/ArrayExecutor.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/array/ArrayFunction.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/array/ArrayPrototype.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/XMLHttpRequest.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/Math.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/RegEx.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/Function.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/Identifier.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/model/internal/FunctionFunction.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/Date.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/Boolean.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/Number.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/String.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/Image.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/Element.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/HTMLElement.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/HTMLImageElement.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/Canvas.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/Error.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/model/DOM/Document.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/DocumentExecutor.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/HtmlElement.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/HtmlElementExecutor.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/TextNode.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/Attribute.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/ClassList.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/CSSStyleDeclaration.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/DOMProperties.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/SimpleXPath.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/EventListenerMixin.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/DOM/Event.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/simulator/VariableObject.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/simulator/InternalExecutor.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/simulator/ExecutionContextStack.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/simulator/DependencyCreator.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/simulator/Evaluator.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/InterpreterSimulator.js"></script>

    <script src="../chrome/content/Firecrow/doppelBrowser/browser.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/ExecutionInfo.js"></script>
    <script src="../chrome/content/Firecrow/dependencyGraph/DependencyGenerator.js"></script>
    <script src="../chrome/content/Firecrow/Slicer.js"></script>

    <link href="style/codeColoring.css" rel="stylesheet" type="text/css">

    <style>
        .selected { background-color: green; }
        .dependent { background-color: yellow; }
        .secondHandDependencies { background-color: #7FFF00;}
        .unexecuted { color: gray;}
        .executed { color: black;}

        .clearer { clear: both;}

        #slicedSourceTextContainer
        {
            width: 1000px;
            height: 800px;
        }

    </style>

    <style>
    @CHARSET "UTF-8";

    .script > *
    {
        color: black;
    }
    .style > *
    {
        color: black;
    }
    .html
    {
        color: #00008b;
    }
    .htmlTag
    {
        color: blue;
    }
    .htmlAttributeName
    {
        color: #00008b;
    }
    .htmlAttributeValue
    {
        color: red;
    }
    .htmlContent
    {
        color: black;
    }
    .cssSelector
    {
        color: #00008b;
    }
    .cssCharset
    {
        color: #5f9ea0;
        padding-left: 10px;
    }
    .cssRule
    {
        color: black;
    }

    .BlockStatement > *
    {
        margin-left: 10px;
    }
    .BlockStatement > .Bracket
    {
        margin-left: 0px;
    }

    .Keyword, .keyword { color: #00008b;}

    .identifier { font-weight: normal;}

    .literal, .String, .RegExp { color: red; }

    .String { color: red; }
    .Number { color: #ff4500; }
    .RegExp { color: red; }

    .lineContainer {
        padding: 0 4px 0 6px;
        border-right: 2px solid #6CE26C;
        text-align: right;
        clear: both;
        float: left;
    }
    #codeHtmlContainer {
        padding-left: 10px;
        float: left;
    }
    .jsContainer
    {
        padding-left: 10px;
    }
    .documentType
    {
        color: #c3c4c2;
    }
    .cssContainer
    {
        padding-left: 10px;
    }
    .cssRule
    {
        padding-left: 10px;
    }
    #lineNumberContainer
    {
        border-right: 2px solid #6CE26C;
        padding: 0 4px 0 6px;
        text-align: right;
        float: left;
        width: 20px;
    }
    body
    {
        font-family: Consolas;
        font-size: 14px;
    }

    .Selected
    {
        background-color: #c6ff61;
    }

    .active
    {
        background-color: #c6ff61;
    }

    .dataDependency
    {
        background-color: #5f9ea0;
    }

    .structuralDependency
    {
        background-color: orange;
    }

    .hoverMenu
    {
        position: fixed;
        right: 50px;
        top: 50px;
        z-index: 100;

        border: 1px solid black;
        background: #b8ff3f;
        font-size: 75%;
        padding: 8px;
        width: 230px;
    }
    #button1
    {
        background: blue;
    }
    #button2
    {
        background: orange;
    }
    #button3
    {
        background: red;
    }
    #button4
    {
        background: yellow;
    }
    .buttons
    {
        width: 150px;
        height: 150px;
        background: #f5f5f5;
    }
    .hoverMenuButton
    {
        margin: 10px;
        background: #f5f5f5;
        width: 50px;
        height: 50px;
    }
    .collapseButton
    {
        float: left;
        position: relative;
        left: -8px;
        top: 2px;
        width: 12px;
        height: 12px;
        background-color: #5f9ea0;
    }

    .label
    {
        color: black;
    }

    .indented
    {
        padding-left: 10px;
    }

    .BlockStatement > *, .IfStatement > .BlockStatement
    {
        margin-left: 10px;
    }
    .clearer { clear: both;}

    .hasBeenExecuted
    {
        font-weight: 900;
    }

    .hasNotBeenExecuted
    {
        font-weight: 100;
    }

    .unexecuted { color: gray;}
    .executed { color: black; }

    .differs {
        background-color: red;
    }
    </style>
</head>
<body>
<h1>Firecrow - Debugging Test pages</h1>
<iframe id="firecrowFrame" height="800" width="1300"></iframe>
<div>
    <a id="testIdContainer"></a>
</div>

<br/>
<span id="resultTitle">Result:</span>
Time: <span id="timeContainer"></span><br/>
SC: <span id="slicingCriteriaCount"></span><br>
Eval Expr:<span id="noEvaluatedExpressions"></span><br>
<br/>
<table>
    <tr>
        <td><div id="profiledCodeContainer"></div></td>
        <td><div id="recordedCodeContainer"></div></td>
    </tr>
</table>

<div style="clear:both"/>

<script>
    var Firecrow = FBL.Firecrow;
    var timeContainer = document.getElementById("timeContainer");

    var htmlModel = HtmlModelMapping.getFirstModelMapping();
    var url = htmlModel.url;
    var slicingCriteria = htmlModel.results.map(function(result)
    {
        for(var propName in result)
        {
            return Firecrow.DependencyGraph.SlicingCriterion.createReadIdentifierCriterion(url, -1, propName);
        }
    });

    if(htmlModel.model.trackedElementsSelectors != null)
    {
        htmlModel.model.trackedElementsSelectors.forEach(function(selector)
        {
            slicingCriteria.push(Firecrow.DependencyGraph.SlicingCriterion.createModifyDomCriterion(selector));
        });
    }

    var browser = Firecrow.Slicer.profile(htmlModel.model, url).browser;
    document.getElementById("profiledCodeContainer").innerHTML = FBL.Firecrow.CodeMarkupGenerator.generateHtmlRepresentation(htmlModel.model);

    var executedLines = {};
    var encounteredLines = {};

    for(var i = 0; i < allExecutions.length; i++)
    {
        var execution = allExecutions[i];
        if(executedLines[execution.file] == null)
        {
            executedLines[execution.file] = {};
            encounteredLines[execution.file] = {};
        }

        if(executedLines[execution.file][execution.line] == null)
        {
            encounteredLines[execution.file][execution.line] = 0
        }

        encounteredLines[execution.file][execution.line]++;
        executedLines[execution.file][execution.line] = true;
    }

    executedLines["file:///C:/GitWebStorm/Firecrow/evaluation/fullPages/06-idt/scripts/jQuery.js"] = executedLines["http://localhost/Firecrow/evaluation/fullPages/12-idt/scripts/jQuery.js"];
    executedLines["file:///C:/GitWebStorm/Firecrow/evaluation/fullPages/06-idt/scripts/page.js"] = executedLines["http://localhost/Firecrow/evaluation/fullPages/12-idt/scripts/page.js"];
    executedLines["file:///C:/GitWebStorm/Firecrow/evaluation/fullPages/12-idt/scripts/jQuery.js"] = executedLines["http://localhost/Firecrow/evaluation/fullPages/12-idt/scripts/jQuery.js"];
    executedLines["file:///C:/GitWebStorm/Firecrow/evaluation/fullPages/12-idt/scripts/page.js"] = executedLines["http://localhost/Firecrow/evaluation/fullPages/12-idt/scripts/page.js"];

    var baseUrl = htmlModel.url;
    var currentFilePath = baseUrl;
    Firecrow.ASTHelper.traverseAst(htmlModel.model, function(node)
    {
        var previousValue = node.hasBeenExecuted || false;
        node.hasBeenExecuted = false;

        if(node.path != null && node.path != "") //the program node has node.path attribute, set it
        {
            currentFilePath = node.path;
        }

        if(node.type == "script" || node.type == "SCRIPT") //if we return to main page, reset the path to the base page path
        {
            currentFilePath = baseUrl;
        }

        if(node.loc != null && executedLines[currentFilePath] != null && executedLines[currentFilePath][node.loc.start.line])
        {
            node.hasBeenExecuted = true;
        }

        if(previousValue != node.hasBeenExecuted && node.type != "BlockStatement" && node.loc != null
        && node.domElement == null && node.rules == null && node.path == null
        && node.cssText == null && node.type != "Program" && !ASTHelper.isFunctionParameter(node)
        && !ASTHelper.isVariableDeclarator(node) && !ASTHelper.isVariableDeclarator(node.parent))
        {
            node.differsInExecution = true;
        }
    });



    document.getElementById("recordedCodeContainer").innerHTML = FBL.Firecrow.CodeMarkupGenerator.generateHtmlRepresentation(htmlModel.model);


    document.getElementById("slicingCriteriaCount").textContent = Firecrow.DependencyGraph.DependencyGraph.noOfSlicingCriteria;
    document.getElementById("noEvaluatedExpressions").textContent = Firecrow.Interpreter.InterpreterSimulator.noOfEvaluatedExpressions;

</script>
</body>
</html>