<!DOCTYPE html>
<html>
<head>
    <title>MooTools break-down</title>
    <meta charset="UTF-8"/>
</head>
<body>
    <h1> MooTools break down </h1>
    <div id="mainContentContainer"></div>
    <script>
  var Native = function(options)
  {
    var initialize = options.initialize;
    var afterImplement = options.afterImplement;
    var object = initialize;
    var add = function(obj, name, method, force)
    {
      afterImplement.call(obj, name, method);
    };
    object.implement = function(a1, a2, a3)
    {
      for(var p in a1)
      {
        add(this, p, a1[p], a2);
      }
    };
    return object;
  };
  Native.implement = function(objects, properties)
  {
    for(var i = 0, l = objects.length;i < l;i++)
    {
      objects[i].implement(properties);
    }
  };
  function $pick()
  {
    for(var i = 0, l = arguments.length;i < l;i++)
    {
      if(arguments[i] != undefined)
      {
        return arguments[i];
      }
    }
  }
  var Document = new Native({
    initialize: function(doc)
    {}, 
    afterImplement: function(property, value)
    {
      document[property] = Document.Prototype[property] = value;
    }
  });
  Document.Prototype = {};
  var storage = {};
  var get = function()
  {
    var arg = storage[0];
    if(!arg)
    {
      arg = storage[0] = {};
    }

    return arg;
  };
  Native.implement([Document], {
    retrieve: function(property, dflt)
    {
      var storage = get(), prop = storage[property];
      if(dflt != undefined && prop == undefined)
      {
        prop = storage[property] = dflt;
      }

      return $pick(prop);
    }, 
    addEvent: function(type, fn)
    {
      var events = this.retrieve('events', {});
      if(!(events[type]))
      {
        events[type] = {
          'keys': []
        };
      }

      var self = this;
      var defn = function()
      {
        return fn.call(self);
      };
      this.addEventListener(type, defn, false);
    }, 
    fireEvent: function(type, args)
    {
      var events = this.retrieve('events');
      var keys = events[type].keys;
      keys.forEach(function(fn)
      {
        fn();
      }, this);
    }
  });
  document.addEvent('DOMContentLoaded', function()
  {
    document.fireEvent('domready');
  });
</script>
    <script>
  document.addEvent('domready', function()
  {
    var contentContainer = document.getElementById('mainContentContainer');
    contentContainer.textContent += 'Hello from MooTools DOM ready';
  });
</script>

</body>
</html>