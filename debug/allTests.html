<!DOCTYPE html>
<html>
<head>
    <title>Firecrow - Debugging Doppel Browser</title>
    <script>
        var FBL = undefined;
    </script>
    <script src="../chrome/content/Firecrow/initFBL.js"></script>
    <script src="htmlModelMapping.js"></script>
    <script src="htmlModelMapping1.js"></script>
    <script src="../chrome/content/Firecrow/helpers/valueTypeHelper.js"></script>
    <script src="../chrome/content/Firecrow/helpers/ASTHelper.js"></script>
    <script src="../chrome/content/Firecrow/helpers/htmlHelper.js"></script>

    <script src="../chrome/content/Firecrow/dependencyGraph/node.js"></script>
    <script src="../chrome/content/Firecrow/dependencyGraph/edge.js"></script>
    <script src="../chrome/content/Firecrow/dependencyGraph/dependencyGraph.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/commands/CommandGenerator.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/model/Object.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/GlobalObject.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/Array.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/Function.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/Identifier.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/HtmlElement.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/Document.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/model/internal/Boolean.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/Number.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/model/internal/String.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/simulator/VariableObject.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/simulator/InternalExecutor.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/simulator/ExecutionContextStack.js"></script>
    <script src="../chrome/content/Firecrow/interpreter/simulator/Evaluator.js"></script>

    <script src="../chrome/content/Firecrow/interpreter/InterpreterSimulator.js"></script>

    <script src="../chrome/content/Firecrow/doppelBrowser/webFile.js"></script>
    <script src="../chrome/content/Firecrow/doppelBrowser/browser.js"></script>
</head>
<body>
<h1>Firecrow - Doppel Browser - run all tests</h1>

<div id="canvas" style='height: 500; width: 1300'></div>
<div id="messageContainer"></div>
<script>
    var Firecrow = FBL.Firecrow;
    var WebFile = Firecrow.DoppelBrowser.WebFile;
    var Browser = Firecrow.DoppelBrowser.Browser;
    var browser = null;

    function getFirstProperty(object)
    {
        for(var propName in object) { return propName; }
    }

    var index = 0;
    var loopThroughModels = function()
    {
        var model = HtmlModelMapping.models[index];

        if(model.url == "file:///C:/GitWebStorm/Firecrow/debug/testFiles/23/index.html") { return; }
        if(model.url == "file:///C:/GitWebStorm/Firecrow/debug/testFiles/24/index.html") { return; }
        if(model.url == "file:///C:/GitWebStorm/Firecrow/debug/testFiles/25/index.html") { return; }

        document.write("Running tests on: " + model.url + "<br/>");

        var webFile = new WebFile(model.url);

        var dependencyGraph = new Firecrow.DependencyGraph.DependencyGraph();
        browser = new Browser(webFile, []);

        browser.asyncBuildPage(function()
        {
            var hasFoundErrors = false;

            if(model.results == null) { alert(model.url);}

            model.results.forEach(function(result)
            {
                var propertyName = getFirstProperty(result);

                var hasBeenFound = browser.globalObject.properties.some(function(property)
                {
                    if(property.name == propertyName)
                    {
                        if(result[propertyName] != property.value)
                        {
                            hasFoundErrors = true;
                            document.write("<span style='color:red'>&nbsp;&nbsp;Invalid property value: " + propertyName + "</span><br/>");
                        }

                        return true;
                    }
                });

                if(!hasBeenFound)
                {
                    hasFoundErrors = true;
                    document.write("<span style='color:red'>&nbsp;&nbsp;Property " + propertyName + " has not been found!</span> <br/>");
                }
            });

            if(!hasFoundErrors) { document.write("<span style='color:green'>Test OK</span><br/>");}

            index++;

            if(index < HtmlModelMapping.models.length)
            {
                setTimeout(loopThroughModels, 50);
            }
        });
    };

    setTimeout(loopThroughModels, 50);
</script>

</body>
</html>
