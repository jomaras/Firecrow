<!DOCTYPE html>
<html>
<head>
    <title>CloneDetector</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="modelMapping.js"></script>
    <script src="../../chrome/content/Firecrow/initFBL.js"></script>

    <script src="../../chrome/content/Firecrow/helpers/valueTypeHelper.js"></script>
    <script src="../../chrome/content/Firecrow/helpers/ASTHelper.js"></script>

    <script src="../../chrome/content/Firecrow/cloneDetector/CloneDetector.js"></script>
    <script src="../../chrome/content/Firecrow/cloneDetector/CombinationsGenerator.js"></script>
    <script src="../../chrome/content/Firecrow/cloneDetector/CharacteristicVector.js"></script>
    <script src="../../chrome/content/Firecrow/cloneDetector/VectorGenerator.js"></script>
    <script src="../../chrome/content/Firecrow/cloneDetector/NodeCombinationsGenerator.js"></script>
    <script src="../../chrome/content/Firecrow/codeMarkupGenerator/codeTextGenerator.js"></script>
    <style>
        .potentialList li:nth-child(odd) { background-color: gray;}
        .potentialList li:nth-child(even) { background-color: #a9a9a9;}
        .middleCell { background-color: black; color: white;}
        #messageContainer { border: #000000; border-style: solid }
    </style>
</head>
<body>
    <h2>CloneDetector - Debugging</h2>
    <div id="messageContainer">
        <h3>Process message container</h3>
    </div>
    <div id="container"></div>
    <script>
        var Firecrow = FBL.Firecrow;
        var startTime = Date.now();
        var model = HtmlModelMapping.getModel("file:///C:/GitWebStorm/Firecrow/debug/cloneDetector/02/index.html");
        var messageContainer = document.querySelector("#messageContainer");
        var mainContainer = document.querySelector("#container");

        Firecrow.CloneDetector.asyncGetClones
        (
            model,
            function(clones)
            {
                var testContainer = document.createElement("div");

                var leftContainer = document.createElement("div");
                leftContainer.style.float = "left";

                var rightContainer = document.createElement("div");
                rightContainer.style.float = "left";

                testContainer.appendChild(leftContainer);
                testContainer.appendChild(rightContainer);

                var codeContainer = document.createElement("pre");
                codeContainer.textContent = Firecrow.CodeTextGenerator.generateCode(model);
                leftContainer.appendChild(codeContainer);

                var potentialList = document.createElement("ul");
                potentialList.className = "potentialList";
                rightContainer.appendChild(potentialList);

                for(var i = 0; i < clones.length ; i++)
                {
                    var item = clones[i];

                    var firstItemElement = document.createElement("li");
                    var table = document.createElement("table");

                    firstItemElement.appendChild(table);
                    var row = document.createElement("tr");
                    table.appendChild(row);

                    var leftCell = document.createElement("td");
                    var middleCell = document.createElement("td");
                    middleCell.className = "middleCell";
                    var rightCell = document.createElement("td");

                    row.appendChild(leftCell);
                    row.appendChild(middleCell);
                    row.appendChild(rightCell);

                    middleCell.textContent = " -/-";

                    for(var j = 0; j < item.first.combination.length; j++)
                    {
                        var content = document.createElement("pre");
                        content.textContent = Firecrow.CodeTextGenerator.generateStandAloneCode(item.first.combination[j]);
                        leftCell.appendChild(content);
                    }

                    for(var j = 0; j < item.second.combination.length; j++)
                    {
                        var content = document.createElement("pre");
                        content.textContent = Firecrow.CodeTextGenerator.generateStandAloneCode(item.second.combination[j]);
                        rightCell.appendChild(content);
                    }

                    potentialList.appendChild(firstItemElement);
                }
                mainContainer.appendChild(testContainer);
                var clearer = document.createElement("div");
                clearer.style.clear = "both";
                clearer.textContent = "**************************";
                mainContainer.appendChild(clearer);

                var endTime = Date.now();

                var messageItemContainer = document.createElement("div");
                messageItemContainer.textContent = "Time: " + (endTime - startTime);
                messageContainer.appendChild(messageItemContainer);
            },
            function(message)
            {
                var messageItemContainer = document.createElement("div");
                messageItemContainer.textContent = message;
                messageContainer.appendChild(messageItemContainer);
            }
        );
    </script>
</body>
</html>